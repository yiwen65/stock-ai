# A股股票AI智能分析应用 产品需求文档（PRD）

**文档版本**: v1.0
**创建日期**: 2026-02-12
**产品定位**: 面向个人投资者的AI驱动选股与个股分析工具

---

## 目录

1. [产品概述](#1-产品概述)
2. [数据层需求](#2-数据层需求)
3. [内置经典选股策略模块](#3-内置经典选股策略模块)
4. [个股深度分析框架](#4-个股深度分析框架)
5. [自然语言自定义策略引擎](#5-自然语言自定义策略引擎)
6. [AI分析引擎架构](#6-ai分析引擎架构)
7. [用户交互与界面设计](#7-用户交互与界面设计)
8. [非功能性需求](#8-非功能性需求)
9. [合规与风险声明](#9-合规与风险声明)
10. [技术架构建议](#10-技术架构建议)
11. [MVP范围与迭代路线图](#11-mvp范围与迭代路线图)

---

## 1. 产品概述

### 1.1 产品愿景

打造一款**AI驱动的A股智能选股与分析平台**，让普通投资者也能享受专业级的量化分析能力。通过接入真实市场数据、内置经典投资策略、支持自然语言自定义策略，降低投资决策门槛，提升选股效率与分析深度。

**核心理念**：
- **数据驱动**：基于真实A股市场数据，而非主观臆断
- **策略透明**：所有选股逻辑可追溯、可验证
- **AI赋能**：用自然语言表达投资想法，AI自动执行分析
- **风险优先**：内置风险控制机制，避免高风险标的

### 1.2 目标用户画像

**主要用户群体**：

1. **散户投资者**（占比40%）
   - 特征：投资经验1-3年，资金量5-50万，缺乏系统分析方法
   - 痛点：信息过载、不知如何筛选股票、容易追涨杀跌
   - 需求：简单易用的选股工具、清晰的买卖建议、风险提示

2. **半专业投资者**（占比35%）
   - 特征：投资经验3-10年，资金量50-500万，有一定技术分析基础
   - 痛点：手工筛选效率低、策略回测困难、缺乏多维度分析
   - 需求：高效的策略执行工具、深度个股分析、自定义策略能力

3. **量化爱好者**（占比25%）
   - 特征：具备编程基础或金融工程背景，追求系统化投资
   - 痛点：数据获取成本高、策略开发周期长、缺乏AI分析能力
   - 需求：灵活的策略定制、完整的数据接口、AI辅助分析

### 1.3 核心价值主张

**差异化竞争点**：

1. **真实数据 + 经典策略**
   - 接入AKShare/Tushare等权威数据源，覆盖行情、财务、资金流向
   - 内置格雷厄姆、巴菲特、彼得·林奇等大师级策略，开箱即用

2. **自然语言策略引擎**（核心差异化）
   - 用户用中文描述选股条件，AI自动解析并执行
   - 无需编程，降低量化投资门槛
   - 支持复杂条件组合与模糊表达理解

3. **AI深度分析报告**
   - 基于LLM的多维度个股分析（基本面+技术面+资金面+消息面）
   - 提供综合评分、风险等级、操作建议
   - 分析结论附带推理过程与数据依据

4. **风险控制优先**
   - 自动过滤ST、退市风险股
   - 流动性与市值筛选
   - 每个策略内置风险控制维度

**与竞品对比**：
- vs 同花顺/东方财富：更智能的AI分析，更灵活的自定义策略
- vs 聚宽/优矿：无需编程，自然语言即可定制策略
- vs ChatGPT金融插件：接入真实A股数据，策略更专业

### 1.4 产品形态

**优先级排序**：

**P0 - Web应用**（MVP阶段）
- 理由：开发周期短、跨平台、易于迭代
- 技术栈：React/Vue + FastAPI/Django
- 部署方式：云服务器 + CDN
- 核心功能：选股策略执行、个股分析、自定义策略

**P1 - 桌面端**（Phase 2）
- 理由：专业用户偏好本地应用，数据安全性更高
- 技术栈：Electron/Tauri
- 增强功能：本地数据缓存、离线分析、更快响应速度

**P2 - 移动端**（Phase 3）
- 理由：满足碎片化时间查看需求
- 技术栈：React Native/Flutter
- 核心功能：实时预警推送、快速查看分析报告、简化版选股

---

## 2. 数据层需求

### 2.1 行情数据源

**数据源选型策略**：采用**多数据源组合**方案，确保数据完整性、稳定性与成本可控。

**主数据源**：

1. **AKShare**（优先级：P0）
   - 类型：开源免费Python库
   - 覆盖：A股实时/历史行情、财务数据、板块数据、资金流向、龙虎榜
   - 优势：免费、数据全面、更新及时、社区活跃
   - 限制：无官方SLA保证、高频调用可能被限流
   - 使用场景：MVP阶段主力数据源，覆盖80%以上数据需求
   - 接入方式：`pip install akshare`，Python后端直接调用

2. **Tushare Pro**（优先级：P1）
   - 类型：商业数据服务（需Token，有免费额度）
   - 覆盖：深度财务数据、分钟级行情、指数成分股、机构评级
   - 优势：数据质量高、接口稳定、支持历史回测
   - 限制：免费额度有限（500积分/天），高级数据需付费
   - 使用场景：AKShare数据补充、深度财务分析、策略回测
   - 接入方式：注册获取Token，通过API调用

3. **BaoStock**（优先级：P1）
   - 类型：开源免费证券数据平台
   - 覆盖：历史K线（日/周/月/分钟）、复权数据、财务指标
   - 优势：完全免费、数据稳定、适合历史数据回测
   - 限制：无实时行情、数据更新有延迟（T+1）
   - 使用场景：历史数据回测、策略验证
   - 接入方式：`pip install baostock`

**备选商业数据源**（Phase 2考虑）：

4. **AllTick**
   - 覆盖：实时Level-2行情、逐笔成交、盘口数据
   - 使用场景：高频交易策略、深度盘口分析
   - 成本：按需付费

5. **聚合数据/天行数据**
   - 覆盖：新闻资讯、公告解析、舆情分析
   - 使用场景：消息面分析、事件驱动策略

**数据源容错机制**：
- 主备切换：AKShare失败时自动切换到Tushare
- 数据校验：多源数据交叉验证，发现异常时告警
- 降级策略：实时数据不可用时使用缓存数据+延迟标识

### 2.2 数据类型覆盖

**2.2.1 实时行情数据**（优先级：P0）

| 数据字段 | 说明 | 数据源 | 更新频率 |
|---------|------|--------|---------|
| 股票代码 | 6位代码+市场标识 | AKShare | - |
| 股票名称 | 中文简称 | AKShare | - |
| 最新价 | 当前成交价 | AKShare | 3秒 |
| 涨跌幅 | 相对昨收的涨跌百分比 | AKShare | 3秒 |
| 涨跌额 | 绝对涨跌金额 | AKShare | 3秒 |
| 成交量 | 当日累计成交股数 | AKShare | 3秒 |
| 成交额 | 当日累计成交金额 | AKShare | 3秒 |
| 换手率 | 成交量/流通股本 | AKShare | 3秒 |
| 振幅 | (最高-最低)/昨收 | AKShare | 3秒 |
| 量比 | 当前成交量/过去5日平均 | AKShare | 3秒 |
| 委比 | (委买-委卖)/(委买+委卖) | AKShare | 3秒 |
| 市盈率TTM | 总市值/近12个月净利润 | AKShare | 日更新 |
| 市净率 | 总市值/净资产 | AKShare | 日更新 |
| 总市值 | 总股本×最新价 | AKShare | 3秒 |
| 流通市值 | 流通股本×最新价 | AKShare | 3秒 |

**2.2.2 历史K线数据**（优先级：P0）

| 数据类型 | 周期 | 数据源 | 历史深度 |
|---------|------|--------|---------|
| 日K线 | 日 | AKShare/BaoStock | 全部历史 |
| 周K线 | 周 | AKShare/BaoStock | 全部历史 |
| 月K线 | 月 | AKShare/BaoStock | 全部历史 |
| 分钟K线 | 1/5/15/30/60分钟 | Tushare Pro | 近1年 |

**K线字段**：开盘价、收盘价、最高价、最低价、成交量、成交额、复权因子

**复权类型**：
- 前复权（默认）：用于技术分析
- 后复权：用于收益率计算
- 不复权：用于实际价格展示

**2.2.3 财务数据**（优先级：P0）

**三大报表**：
- 资产负债表：总资产、净资产、负债率、流动比率、速动比率
- 利润表：营业收入、净利润、毛利率、净利率、扣非净利润
- 现金流量表：经营现金流、投资现金流、筹资现金流、自由现金流

**关键财务指标**：
- 盈利能力：ROE、ROA、ROIC、毛利率、净利率
- 成长性：营收增长率、净利润增长率、扣非增长率
- 估值指标：PE、PB、PS、PEG、EV/EBITDA
- 偿债能力：资产负债率、流动比率、速动比率、利息保障倍数
- 运营能力：总资产周转率、应收账款周转率、存货周转率
- 股东回报：股息率、分红率、每股收益、每股净资产

**数据频率**：季报、年报（发布后T+1更新）

**2.2.4 资金流向数据**（优先级：P1）

| 数据类型 | 说明 | 数据源 | 更新频率 |
|---------|------|--------|---------|
| 主力资金 | 大单净流入（>50万或>20万股） | AKShare | 实时 |
| 超大单 | 特大单净流入（>100万） | AKShare | 实时 |
| 大单 | 大单净流入（50-100万） | AKShare | 实时 |
| 中单 | 中单净流入（10-50万） | AKShare | 实时 |
| 小单 | 小单净流入（<10万） | AKShare | 实时 |
| 北向资金 | 沪深港通资金流向 | AKShare | 实时 |
| 融资融券 | 融资余额、融券余额、融资买入额 | AKShare | T+1 |

**2.2.5 板块与概念数据**（优先级：P0）

- 行业板块：申万一级/二级/三级行业分类
- 概念板块：人工智能、新能源、半导体、医药等热点概念
- 地域板块：省份、城市分类
- 指数成分股：沪深300、中证500、创业板指等成分股列表

**2.2.6 辅助数据**（优先级：P1-P2）

| 数据类型 | 说明 | 优先级 | 数据源 |
|---------|------|--------|--------|
| 龙虎榜 | 异动股票的机构/游资席位 | P1 | AKShare |
| 大宗交易 | 大额协议转让记录 | P1 | AKShare |
| 股东变动 | 十大股东、十大流通股东变化 | P1 | Tushare |
| 限售解禁 | 限售股解禁时间表 | P2 | Tushare |
| 机构评级 | 券商研报评级（买入/增持/中性） | P1 | Tushare |
| 业绩预告 | 业绩预增/预减/扭亏公告 | P0 | AKShare |
| 公司公告 | 重大事项公告摘要 | P1 | AKShare |

**2.2.7 宏观经济数据**（优先级：P2）

- 利率数据：LPR、Shibor、国债收益率
- 经济指标：CPI、PPI、PMI、GDP增速
- 货币供应：M0、M1、M2
- 外汇数据：人民币汇率、外汇储备

**使用场景**：市场环境判断、风格轮动分析

### 2.3 数据更新频率与缓存策略

**2.3.1 数据更新频率**

| 数据类型 | 更新频率 | 更新时间窗口 | 延迟容忍度 |
|---------|---------|-------------|-----------|
| 实时行情 | 3秒 | 交易时间（9:30-15:00） | <5秒 |
| 分时数据 | 1分钟 | 交易时间 | <1分钟 |
| 日K线 | 1次/日 | 15:30后 | <30分钟 |
| 财务数据 | 1次/日 | 凌晨2:00 | T+1可接受 |
| 资金流向 | 5分钟 | 交易时间 | <10分钟 |
| 北向资金 | 实时 | 交易时间 | <5分钟 |
| 龙虎榜 | 1次/日 | 18:00后 | T+1可接受 |
| 公告新闻 | 1次/小时 | 全天 | <1小时 |

**2.3.2 缓存策略**

**三级缓存架构**：

1. **L1缓存 - Redis（热数据）**
   - 缓存内容：实时行情、当日K线、热门股票数据
   - 过期时间：3-5秒（实时行情）、1小时（日K线）
   - 容量：10GB
   - 命中率目标：>90%

2. **L2缓存 - 本地内存（超热数据）**
   - 缓存内容：股票基础信息、板块映射关系
   - 过期时间：24小时
   - 容量：1GB
   - 更新策略：启动时加载+定时刷新

3. **L3缓存 - 时序数据库（历史数据）**
   - 数据库：InfluxDB/TimescaleDB
   - 缓存内容：历史K线、历史财务数据
   - 保留策略：
     - 分钟K线：保留1年
     - 日K线：永久保留
     - 财务数据：永久保留
   - 压缩策略：1年前数据压缩存储

**2.3.3 数据同步机制**

**实时数据同步**（交易时间）：
```
定时任务（每3秒）：
1. 从AKShare拉取全市场实时行情
2. 写入Redis缓存（key: stock:{code}:realtime, TTL: 5s）
3. 推送WebSocket给在线用户
4. 异常时切换到Tushare备用源
```

**历史数据同步**（非交易时间）：
```
定时任务（每日16:00）：
1. 拉取当日所有股票日K线数据
2. 写入时序数据库（InfluxDB）
3. 更新Redis缓存（当日K线）
4. 触发策略自动执行任务

定时任务（每日凌晨2:00）：
1. 拉取最新财务数据（季报/年报）
2. 计算衍生指标（ROE、PEG等）
3. 写入PostgreSQL
4. 更新Redis缓存
```

**2.3.4 数据质量保障**

**数据校验规则**：
- 价格合理性：涨跌幅不超过±20%（非ST股）、±10%（ST股）
- 成交量合理性：成交量>0，成交额=成交量×均价
- 财务数据一致性：资产=负债+所有者权益
- 时间序列连续性：K线数据无断档

**异常处理**：
- 数据缺失：使用前一交易日数据+标记"数据延迟"
- 数据异常：触发告警，人工审核
- 数据源故障：自动切换备用数据源

---

## 3. 内置经典选股策略模块

### 3.1 价值投资策略

**3.1.1 格雷厄姆经典价值选股**（优先级：P0）

**策略描述**：基于本杰明·格雷厄姆《聪明的投资者》理论，寻找被低估的安全边际股票。

**筛选条件**：
- PE（市盈率TTM）：5-15倍（默认<15）
- PB（市净率）：<1.5倍（默认<2）
- 股息率：>3%（默认>2%）
- 负债率：<50%（默认<60%）
- 流动比率：>2（默认>1.5）
- 连续盈利年限：≥3年
- 市值：>50亿（避免小盘股风险）

**参数可调范围**：
- PE：[5, 20]
- PB：[0.5, 3]
- 股息率：[1%, 5%]
- 负债率：[30%, 70%]

**验收标准**：
- 筛选结果数量：20-100只股票
- 回测年化收益：>沪深300指数
- 最大回撤：<沪深300指数

**用户故事**：
> 作为保守型投资者，我希望找到财务稳健、估值便宜、有分红的股票，以便长期持有获得稳定收益。

**3.1.2 巴菲特护城河模型**（优先级：P0）

**策略描述**：寻找具有持续竞争优势（护城河）的优质公司。

**筛选条件**：
- ROE（净资产收益率）：连续5年>15%
- ROE稳定性：标准差<5%
- 毛利率：>30%（高利润率体现定价权）
- 自由现金流：连续3年为正
- 营收增长率：近3年平均>10%
- 负债率：<50%
- 市值：>100亿（大盘蓝筹）

**护城河评分维度**（AI辅助评估）：
- 品牌壁垒：消费品、医药龙头
- 成本优势：规模效应、技术领先
- 网络效应：平台型企业
- 转换成本：企业服务、工业软件

**参数可调范围**：
- ROE阈值：[10%, 25%]
- 持续年限：[3年, 10年]
- 毛利率：[20%, 50%]

**验收标准**：
- 筛选结果：10-50只核心资产
- 行业分布：覆盖消费、医药、科技、金融等

**3.1.3 彼得·林奇PEG策略**（优先级：P1）

**策略描述**：寻找成长性与估值匹配的股票（PEG<1为低估）。

**筛选条件**：
- PEG = PE / 净利润增长率 < 1
- 净利润增长率：15%-50%（过高可能不可持续）
- PE：10-30倍（避免过高估值）
- ROE：>15%
- 扣非净利润增长率：>10%（排除非经常性损益）
- 市值：50-500亿（中盘成长股）

**参数可调范围**：
- PEG：[0.5, 1.5]
- 增长率：[10%, 100%]
- PE：[5, 50]

**验收标准**：
- 筛选结果：30-80只成长股
- 行业偏向：科技、消费、医药

### 3.2 技术分析策略

**3.2.1 均线多头排列突破策略**（优先级：P0）

**策略描述**：捕捉趋势启动信号，MA5/10/20/60形成多头排列且价格突破。

**筛选条件**：
- MA5 > MA10 > MA20 > MA60（多头排列）
- 收盘价 > MA5（价格在均线上方）
- MA5向上穿越MA10（金叉）发生在5个交易日内
- 成交量：突破日成交量 > 近20日平均成交量的1.5倍
- 涨幅限制：近5日涨幅<15%（避免追高）

**参数可调范围**：
- 均线周期：[5, 10, 20, 60] 可自定义
- 金叉时间窗口：[3, 10]个交易日
- 放量倍数：[1.2, 2.0]

**验收标准**：
- 每日筛选结果：10-50只
- 信号准确率：>60%（未来5日上涨概率）

**3.2.2 MACD底背离反转策略**（优先级：P1）

**策略描述**：寻找超跌反弹机会，价格创新低但MACD不创新低。

**筛选条件**：
- 价格：创近60日新低
- MACD：DIF未创新低（底背离）
- MACD金叉：DIF向上穿越DEA
- RSI：<30（超卖区域）
- 跌幅：近30日跌幅>20%

**参数可调范围**：
- 背离周期：[30, 90]个交易日
- RSI阈值：[20, 40]
- 跌幅阈值：[15%, 40%]

**验收标准**：
- 每日筛选结果：5-20只
- 反弹成功率：>50%（未来10日反弹>5%）

**3.2.3 放量突破平台策略**（优先级：P0）

**策略描述**：横盘整理后放量突破，捕捉主升浪起点。

**筛选条件**：
- 横盘整理：近20日最高价与最低价波动<10%
- 突破信号：收盘价突破近20日最高价
- 放量确认：成交量 > 近20日平均成交量的2倍
- 整理时长：横盘天数≥10个交易日
- 前期涨幅：整理前30日涨幅>15%（强势股）

**参数可调范围**：
- 横盘波动幅度：[5%, 15%]
- 放量倍数：[1.5, 3.0]
- 整理天数：[5, 30]

**验收标准**：
- 每日筛选结果：5-15只
- 突破成功率：>65%（未来10日继续上涨）

**3.2.4 布林带收口突破策略**（优先级：P2）

**策略描述**：布林带收窄后突破上轨，预示波动率扩大。

**筛选条件**：
- 布林带宽度：近5日平均宽度<近60日平均宽度的50%
- 突破信号：收盘价突破布林带上轨
- 放量确认：成交量 > 近20日平均成交量的1.5倍
- 趋势确认：MA20向上

**参数可调范围**：
- 布林带周期：[20, 30]
- 标准差倍数：[1.5, 2.5]
- 收口阈值：[40%, 60%]

### 3.3 动量与趋势策略

**3.3.1 相对强度（RS）动量策略**（优先级：P1）

**策略描述**：选择相对大盘表现最强的股票。

**筛选条件**：
- RS = 个股涨幅 / 沪深300涨幅
- 近20日RS > 1.2（跑赢大盘20%）
- 近60日RS > 1.1（中期强势）
- 近5日涨幅：0%-8%（避免短期过热）
- 换手率：>2%（流动性充足）

**参数可调范围**：
- RS阈值：[1.1, 1.5]
- 观察周期：[10, 90]个交易日
- 涨幅限制：[0%, 15%]

**验收标准**：
- 筛选结果：20-50只强势股
- 持续性：未来20日继续跑赢大盘概率>60%

**3.3.2 双动量策略**（优先级：P1）

**策略描述**：结合绝对动量（自身涨幅）与相对动量（相对大盘）。

**筛选条件**：
- 绝对动量：近60日涨幅>10%（上涨趋势）
- 相对动量：近60日涨幅 > 沪深300涨幅
- 动量加速：近20日涨幅 > 近60日涨幅的50%
- 回撤控制：近20日最大回撤<15%

**参数可调范围**：
- 绝对动量阈值：[5%, 30%]
- 相对动量：跑赢大盘[0%, 20%]
- 回撤限制：[10%, 25%]

**3.3.3 趋势跟踪策略（ATR通道）**（优先级：P2）

**策略描述**：基于ATR（真实波动幅度）构建动态通道，跟踪趋势。

**筛选条件**：
- 价格 > MA20 + 2×ATR（突破上轨）
- MA20向上（趋势向上）
- ATR扩大：当前ATR > 近20日平均ATR的1.2倍
- 持续时长：趋势持续>5个交易日

**参数可调范围**：
- ATR倍数：[1.5, 3.0]
- 均线周期：[10, 30]
- ATR周期：[10, 20]

### 3.4 多因子量化策略

**3.4.1 Fama-French三因子模型**（优先级：P2）

**策略描述**：基于市场因子、规模因子、价值因子选股。

**筛选条件**：
- 市场因子：Beta 0.8-1.2（系统性风险适中）
- 规模因子：市值50-300亿（小盘股溢价）
- 价值因子：PB<2且PE<20（价值股溢价）
- 综合评分：三因子加权得分排名前20%

**参数可调范围**：
- 市值范围：[20亿, 1000亿]
- PB阈值：[0.5, 3]
- PE阈值：[5, 30]

**3.4.2 质量因子选股**（优先级：P1）

**策略描述**：选择财务质量高、盈利稳定的公司。

**筛选条件**：
- ROE：>15%且连续3年递增
- 负债率：<40%
- 经营现金流/净利润：>0.8（盈利质量高）
- 应收账款周转率：>行业中位数
- 毛利率：>行业中位数
- 扣非净利润占比：>80%

**质量评分模型**：
```
质量得分 = ROE权重×30% + 现金流权重×25% + 负债权重×20% +
          周转率权重×15% + 毛利率权重×10%
```

**参数可调范围**：
- ROE阈值：[10%, 25%]
- 负债率：[20%, 60%]
- 现金流比率：[0.6, 1.2]

**3.4.3 小市值+低估值因子组合**（优先级：P2）

**策略描述**：捕捉小盘股与价值股的双重溢价。

**筛选条件**：
- 市值：20-100亿
- PE：<行业平均PE的80%
- PB：<1.5
- ROE：>10%
- 流动性：日均成交额>5000万

**参数可调范围**：
- 市值范围：[10亿, 200亿]
- 估值折扣：[60%, 90%]行业平均

### 3.5 事件驱动策略

**3.5.1 业绩预增/扭亏选股**（优先级：P0）

**策略描述**：捕捉业绩超预期带来的投资机会。

**筛选条件**：
- 业绩预告：净利润增长率>50%或扭亏为盈
- 公告时间：近10个交易日内发布
- 估值合理：PE<30（避免高估值）
- 涨幅控制：公告后涨幅<20%（避免追高）
- 市值：>30亿

**参数可调范围**：
- 增长率阈值：[30%, 200%]
- 公告时间窗口：[5, 30]个交易日
- 涨幅限制：[0%, 30%]

**验收标准**：
- 每季度筛选结果：20-50只
- 后续涨幅：公告后30日平均涨幅>10%

**3.5.2 股东增持/回购信号**（优先级：P1）

**策略描述**：大股东增持或公司回购通常是看好信号。

**筛选条件**：
- 增持/回购公告：近30日内发布
- 增持金额：>1000万元
- 增持比例：>0.5%总股本
- 股价位置：低于近60日均价（低位增持）
- 市值：>50亿

**参数可调范围**：
- 增持金额：[500万, 5000万]
- 增持比例：[0.3%, 2%]
- 时间窗口：[10, 60]个交易日

**3.5.3 北向资金持续流入标的**（优先级：P0）

**策略描述**：跟踪外资动向，北向资金持续买入的股票。

**筛选条件**：
- 北向资金：连续5日净流入
- 累计流入：近10日累计流入>1亿元
- 持股比例：北向持股比例>1%
- 涨幅控制：近10日涨幅<10%
- 市值：>100亿（北向偏好大盘股）

**参数可调范围**：
- 连续流入天数：[3, 10]
- 流入金额：[5000万, 5亿]
- 涨幅限制：[0%, 15%]

**验收标准**：
- 每日筛选结果：10-30只
- 后续表现：未来20日跑赢大盘概率>65%

### 3.6 风险控制维度

**所有策略内置以下风险过滤规则**（优先级：P0）：

**3.6.1 强制排除条件**：
- ST/*ST股票：特别处理股票
- 退市风险股：连续亏损、面值退市风险
- 停牌股：当前处于停牌状态
- 次新股：上市<60个交易日（可选）
- 涨停/跌停股：当日涨跌停（避免追涨杀跌）

**3.6.2 流动性筛选**：
- 最低日均成交额：>5000万元（默认）
- 最低换手率：>0.5%
- 连续无成交天数：<3天

**3.6.3 市值范围筛选**：
- 超大盘股：>1000亿
- 大盘股：300-1000亿
- 中盘股：100-300亿
- 小盘股：50-100亿
- 微盘股：<50亿（高风险，默认排除）

**3.6.4 行业/板块过滤**：
- 支持按行业筛选（申万一级/二级）
- 支持按概念筛选（新能源、半导体等）
- 支持排除特定行业（如房地产、钢铁等周期股）

**3.6.5 风险评分机制**：
每只股票计算综合风险评分（1-10分）：
- 财务风险：负债率、现金流、盈利稳定性
- 估值风险：PE/PB百分位、泡沫指数
- 流动性风险：成交额、换手率
- 波动性风险：历史波动率、Beta值
- 事件风险：诉讼、处罚、股权质押比例

**风险等级划分**：
- 低风险：8-10分（蓝筹白马）
- 中风险：5-7分（成长股）
- 高风险：1-4分（题材股、ST股）

**用户可配置**：
- 最低风险评分：默认5分
- 允许的风险等级：低+中（默认）

---

## 4. 个股深度分析框架

当用户选中某只股票后，系统提供**AI驱动的多维度深度分析报告**，整合基本面、技术面、资金面、消息面数据，输出结构化分析结论与操作建议。

### 4.1 分析报告整体结构

**报告组成**（优先级：P0）：

```
┌─────────────────────────────────────┐
│  个股分析报告：贵州茅台（600519）    │
├─────────────────────────────────────┤
│ 1. 核心指标卡片                      │
│    - 最新价、涨跌幅、市值、PE/PB     │
│    - AI综合评分（1-10分）            │
│    - 风险等级（低/中/高）            │
│    - 操作建议（买入/持有/观望/卖出） │
├─────────────────────────────────────┤
│ 2. 基本面分析                        │
│    - 财务健康度评分                  │
│    - 盈利能力趋势                    │
│    - 成长性评估                      │
│    - 估值合理性                      │
├─────────────────────────────────────┤
│ 3. 技术面分析                        │
│    - 当前趋势判断                    │
│    - 关键支撑/压力位                 │
│    - 技术指标综合信号                │
├─────────────────────────────────────┤
│ 4. 资金面分析                        │
│    - 主力资金动向                    │
│    - 筹码分布                        │
│    - 北向资金持仓变化                │
├─────────────────────────────────────┤
│ 5. 消息面分析                        │
│    - 近期公告摘要                    │
│    - 行业政策影响                    │
│    - 市场情绪判断                    │
├─────────────────────────────────────┤
│ 6. 同行业对比                        │
│    - 关键指标横向对比                │
│    - 行业排名                        │
├─────────────────────────────────────┤
│ 7. AI综合评估                        │
│    - 投资逻辑总结                    │
│    - 风险提示                        │
│    - 操作建议与理由                  │
└─────────────────────────────────────┘
```

### 4.2 基本面分析模块

**4.2.1 财务健康度评分**（优先级：P0）

**评分维度**（总分100分）：

| 维度 | 权重 | 评分标准 | 数据来源 |
|------|------|---------|---------|
| 盈利能力 | 30% | ROE、ROA、净利率、毛利率 | 财务报表 |
| 偿债能力 | 20% | 资产负债率、流动比率、利息保障倍数 | 资产负债表 |
| 成长能力 | 25% | 营收增长率、净利润增长率、扣非增长率 | 利润表 |
| 运营能力 | 15% | 总资产周转率、应收账款周转率 | 财务报表 |
| 现金流 | 10% | 经营现金流/净利润、自由现金流 | 现金流量表 |

**评分规则**：
- 90-100分：财务极其健康（蓝筹白马）
- 75-89分：财务良好（优质成长股）
- 60-74分：财务一般（普通公司）
- 40-59分：财务较差（需警惕）
- <40分：财务风险高（避免投资）

**AI分析输出示例**：
```
财务健康度：85分（良好）

【盈利能力】★★★★☆
- ROE 22.3%，连续5年>20%，盈利能力强
- 毛利率 91.2%，行业领先，定价权强
- 净利率 52.1%，远超行业平均

【偿债能力】★★★★★
- 资产负债率 28.5%，财务杠杆低
- 流动比率 4.2，短期偿债能力强
- 账上现金充裕，无债务压力

【成长能力】★★★☆☆
- 营收增长率 12.3%，稳健增长
- 净利润增长率 18.5%，盈利增速快于营收
- 扣非净利润增长率 17.2%，盈利质量高

【风险提示】
- 应收账款周转天数增加，需关注回款情况
```

**4.2.2 盈利能力趋势分析**（优先级：P0）

**分析内容**：
- ROE趋势图（近5年）：判断盈利能力是上升、稳定还是下降
- 杜邦分析：拆解ROE = 净利率 × 总资产周转率 × 权益乘数
- 毛利率/净利率趋势：判断成本控制能力
- 与行业对比：盈利能力在行业中的位置

**AI分析输出示例**：
```
【盈利能力趋势】上升通道

ROE近5年走势：18.2% → 19.5% → 21.3% → 22.1% → 22.3%
- 持续提升，盈利能力增强

杜邦分析：
- 净利率：52.1%（↑）- 主要驱动力
- 总资产周转率：0.42（→）- 保持稳定
- 权益乘数：1.02（→）- 低杠杆运营

结论：盈利能力提升主要来自净利率提升，成本控制优秀
```

**4.2.3 成长性评估**（优先级：P0）

**评估指标**：
- 营收CAGR（近3年复合增长率）
- 净利润CAGR
- 扣非净利润CAGR
- 单季度增速（环比、同比）
- 业绩预告情况

**成长性分类**：
- 高成长：CAGR > 30%
- 稳健成长：CAGR 15%-30%
- 低速成长：CAGR 5%-15%
- 停滞：CAGR < 5%
- 衰退：CAGR < 0%

**AI分析输出示例**：
```
【成长性评估】稳健成长型

近3年CAGR：
- 营收：15.2%
- 净利润：18.7%
- 扣非净利润：17.9%

单季度表现（2025Q3）：
- 营收同比+12.5%，环比+8.3%
- 净利润同比+16.2%，环比+10.1%

业绩预告：预计2025年净利润增长15%-20%

结论：业绩增长稳健，盈利增速快于营收，盈利质量提升
```

**4.2.4 估值合理性分析**（优先级：P0）

**估值方法**：
- 相对估值：PE、PB、PS与历史分位、行业对比
- 绝对估值：DCF现金流折现（简化版）
- PEG估值：PE/净利润增长率

**估值判断**：
```
当前PE：35.2倍
- 历史分位：62%（近5年）
- 行业平均PE：28.5倍
- 判断：略高于行业平均，处于历史中位

PEG = 35.2 / 18.5 = 1.9
- 判断：PEG > 1.5，估值偏高

DCF估值（简化）：
- 假设未来5年净利润增长15%
- 折现率10%
- 合理估值区间：30-40倍PE
- 当前估值：合理偏高

综合判断：估值处于合理区间上沿，不便宜但也未明显高估
```

### 4.3 技术面分析模块

**4.3.1 当前趋势判断**（优先级：P0）

**趋势识别**：
- 均线系统：MA5/10/20/60排列状态
- 趋势线：支撑线、压力线
- 趋势强度：ADX指标

**趋势分类**：
- 强势上涨：多头排列 + ADX > 25
- 弱势上涨：价格>MA20但均线未多头排列
- 横盘整理：价格在MA20附近波动
- 弱势下跌：价格<MA20
- 强势下跌：空头排列 + ADX > 25

**AI分析输出示例**：
```
【当前趋势】强势上涨

均线系统：MA5 > MA10 > MA20 > MA60（多头排列）
- MA5：1850元
- MA10：1820元
- MA20：1780元
- MA60：1650元

趋势强度：ADX = 32（强趋势）

结论：多头趋势明确，短期均线向上发散，趋势强劲
```

**4.3.2 关键支撑/压力位**（优先级：P0）

**识别方法**：
- 历史高低点
- 密集成交区（成交量堆积）
- 整数关口（如1800、2000元）
- 均线位置
- 黄金分割位

**AI分析输出示例**：
```
【关键价格位】

当前价：1875元

压力位：
- 第一压力：1900元（整数关口 + 前期高点）
- 第二压力：1950元（历史密集成交区）
- 第三压力：2000元（整数关口 + 心理关口）

支撑位：
- 第一支撑：1850元（MA5 + 近期低点）
- 第二支撑：1820元（MA10）
- 第三支撑：1780元（MA20 + 密集成交区）

操作建议：
- 突破1900元可追涨，目标1950元
- 跌破1850元需止损，支撑位1820元
```

**4.3.3 技术指标综合信号**（优先级：P0）

**指标组合**：

| 指标 | 当前值 | 信号 | 权重 |
|------|--------|------|------|
| MACD | DIF>DEA且>0 | 买入 | 25% |
| RSI | 65 | 中性偏强 | 20% |
| KDJ | K>D>J | 买入 | 15% |
| 布林带 | 价格>中轨 | 买入 | 15% |
| 成交量 | 放量 | 买入 | 25% |

**综合信号计算**：
```
买入信号强度 = Σ(指标信号 × 权重)
= 1×25% + 0.5×20% + 1×15% + 1×15% + 1×25%
= 90%

综合判断：强烈买入信号
```

**AI分析输出示例**：
```
【技术指标】多头信号强烈

MACD：金叉向上，DIF=15.2，DEA=12.3
- 信号：买入

RSI(14)：65
- 信号：强势但未超买（<70）

KDJ：K=78，D=72，J=85
- 信号：多头排列，买入

布林带：价格突破上轨
- 信号：强势突破，买入

成交量：放量突破
- 今日成交额：85亿（近20日均值：52亿）
- 信号：资金涌入，买入

综合技术评分：90分（强烈买入）
```

### 4.4 资金面分析模块

**4.4.1 主力资金动向**（优先级：P0）

**分析维度**：
- 主力资金净流入/流出（近1日、5日、10日、20日）
- 超大单/大单/中单/小单分布
- 主力成本估算
- 主力控盘度

**AI分析输出示例**：
```
【主力资金】持续流入

近期资金流向：
- 今日：净流入 +8.5亿（超大单+5.2亿，大单+3.3亿）
- 近5日：净流入 +22.3亿
- 近10日：净流入 +35.7亿

资金结构：
- 超大单（>100万）：+5.2亿（主力大举买入）
- 大单（50-100万）：+3.3亿
- 中单（10-50万）：-1.5亿
- 小单（<10万）：-2.5亿（散户卖出）

主力成本：约1820元（近20日加权平均）
当前价：1875元（主力浮盈3%）

结论：主力持续吸筹，散户卖出，典型的主力建仓特征
```

**4.4.2 筹码分布分析**（优先级：P1）

**分析内容**：
- 筹码集中度：筹码分布在哪些价格区间
- 获利盘比例：当前价格以下的筹码占比
- 套牢盘比例：当前价格以上的筹码占比
- 筹码转移：筹码是否从低位向高位转移

**AI分析输出示例**：
```
【筹码分布】筹码集中，获利盘充足

筹码集中度：78%的筹码分布在1750-1850元
- 主力成本区：1800-1850元（占比45%）
- 散户成本区：1750-1800元（占比33%）

获利盘：82%（大部分持仓者盈利）
套牢盘：18%（少量高位套牢盘）

筹码转移：近10日筹码从1750-1800元向1850-1900元转移
- 判断：主力拉升，散户追涨

结论：筹码集中在主力手中，获利盘充足但未大量抛售，上涨动力足
```

**4.4.3 北向资金持仓变化**（优先级：P1）

**分析内容**：
- 北向资金持股数量与比例
- 近期增减持情况
- 北向资金成本估算

**AI分析输出示例**：
```
【北向资金】持续加仓

持股情况：
- 持股数量：2.35亿股
- 持股比例：4.82%（流通股本）
- 持股市值：440亿元

近期变化：
- 今日：+520万股
- 近5日：+2850万股
- 近10日：+4200万股

北向成本：约1780元
当前价：1875元（北向浮盈5.3%）

结论：北向资金持续加仓，看好长期价值
```

### 4.5 消息面分析模块

**4.5.1 近期公告摘要**（优先级：P1）

**公告类型**：
- 业绩公告：业绩预告、业绩快报、财报
- 重大事项：重组、收购、资产注入
- 股东变动：增持、减持、股权转让
- 分红派息：分红预案、实施公告
- 风险提示：诉讼、处罚、担保

**AI分析输出示例**：
```
【近期公告】利好消息

2026-02-10：2025年业绩快报
- 营收：1250亿元，同比+12.5%
- 净利润：650亿元，同比+16.2%
- 点评：业绩超预期，盈利增速快于营收

2026-02-05：控股股东增持公告
- 增持数量：500万股
- 增持金额：9.2亿元
- 点评：大股东看好公司发展，增持彰显信心

2026-01-28：分红预案
- 每10股派现180元（含税）
- 股息率：约3.2%
- 点评：高分红回馈股东，价值投资标的

综合判断：近期公告偏利好，业绩增长+股东增持+高分红
```

**4.5.2 行业政策影响**（优先级：P2）

**分析内容**：
- 行业政策动态
- 政策对公司的影响（利好/利空/中性）
- 行业景气度判断

**AI分析输出示例**：
```
【行业政策】白酒行业政策稳定

近期政策：
- 2026年1月：国家发改委发布《促进消费扩容提质行动方案》
  影响：利好消费行业，提振白酒需求

- 2025年12月：财政部调整消费税政策
  影响：中性，对高端白酒影响有限

行业景气度：★★★★☆
- 春节旺季需求旺盛
- 高端白酒提价预期强
- 行业集中度持续提升

结论：行业政策稳定，景气度高，利好龙头企业
```

**4.5.3 市场情绪判断**（优先级：P2）

**情绪指标**：
- 换手率：活跃度
- 振幅：波动性
- 涨停/跌停家数：市场情绪
- 北向资金流向：外资情绪
- 融资融券余额：杠杆情绪

**AI分析输出示例**：
```
【市场情绪】乐观

个股情绪：
- 换手率：2.8%（活跃）
- 振幅：5.2%（波动适中）
- 近5日涨幅：8.5%（强势）

市场整体情绪：
- 沪深300：+1.2%
- 涨停家数：85只
- 跌停家数：12只
- 北向资金：净流入52亿

结论：市场情绪乐观，个股表现强于大盘
```

### 4.6 同行业对比模块

**4.6.1 关键指标横向对比**（优先级：P1）

**对比维度**：
- 估值指标：PE、PB、PS
- 盈利指标：ROE、净利率、毛利率
- 成长指标：营收增长率、净利润增长率
- 规模指标：市值、营收、净利润

**AI分析输出示例**：
```
【同行业对比】白酒行业龙头对比

指标对比（贵州茅台 vs 五粮液 vs 泸州老窖）：

估值指标：
- PE：35.2倍 vs 28.5倍 vs 25.3倍
- PB：12.5倍 vs 8.2倍 vs 6.8倍
- 判断：茅台估值溢价明显

盈利指标：
- ROE：22.3% vs 18.5% vs 16.2%
- 净利率：52.1% vs 38.2% vs 32.5%
- 毛利率：91.2% vs 78.5% vs 72.3%
- 判断：茅台盈利能力最强

成长指标：
- 营收增长率：12.5% vs 15.2% vs 18.5%
- 净利润增长率：16.2% vs 18.5% vs 22.3%
- 判断：茅台增速相对较慢

规模指标：
- 市值：2.3万亿 vs 8500亿 vs 3200亿
- 营收：1250亿 vs 850亿 vs 320亿
- 判断：茅台规模最大

综合评价：茅台盈利能力最强，估值溢价合理，但成长性不如竞品
```

**4.6.2 行业排名**（优先级：P2）

**排名维度**：
- 市值排名
- 营收排名
- 净利润排名
- ROE排名
- 增长率排名

**AI分析输出示例**：
```
【行业排名】白酒行业（申万一级）

贵州茅台排名：
- 市值：1/45（行业第一）
- 营收：1/45（行业第一）
- 净利润：1/45（行业第一）
- ROE：1/45（行业第一）
- 净利润增长率：8/45（行业中上游）

结论：行业绝对龙头，各项指标领先
```

### 4.7 AI综合评估模块

**4.7.1 综合评分模型**（优先级：P0）

**评分维度**（总分10分）：

| 维度 | 权重 | 评分依据 |
|------|------|---------|
| 基本面 | 35% | 财务健康度、盈利能力、成长性 |
| 技术面 | 25% | 趋势、技术指标、支撑压力位 |
| 资金面 | 20% | 主力资金、筹码分布、北向资金 |
| 估值 | 15% | PE/PB分位、PEG、DCF估值 |
| 消息面 | 5% | 公告、政策、市场情绪 |

**评分规则**：
- 9-10分：极度看好，强烈买入
- 7-8分：看好，买入
- 5-6分：中性，持有/观望
- 3-4分：看空，减仓
- 1-2分：极度看空，卖出

**4.7.2 风险等级评估**（优先级：P0）

**风险维度**：
- 财务风险：负债率、现金流
- 估值风险：PE/PB百分位
- 流动性风险：成交额、换手率
- 波动性风险：历史波动率、Beta
- 事件风险：诉讼、处罚、股权质押

**风险等级**：
- 低风险：蓝筹白马，财务稳健，估值合理
- 中风险：成长股，估值偏高，波动较大
- 高风险：题材股、ST股，财务风险高

**4.7.3 操作建议**（优先级：P0）

**建议类型**：
- 买入：综合评分≥7分，风险等级≤中风险
- 持有：综合评分5-7分，已持仓
- 观望：综合评分5-7分，未持仓
- 减仓：综合评分3-5分
- 卖出：综合评分<3分或风险等级=高风险

**AI分析输出示例**：
```
【AI综合评估】

综合评分：8.2分（看好）

评分明细：
- 基本面：8.5分（财务健康，盈利能力强）
- 技术面：9.0分（强势上涨，技术指标多头）
- 资金面：8.5分（主力持续流入，北向加仓）
- 估值：6.5分（估值合理偏高）
- 消息面：8.0分（业绩超预期，股东增持）

风险等级：中风险
- 财务风险：低
- 估值风险：中（PE处于历史62%分位）
- 流动性风险：低
- 波动性风险：中（Beta=0.85）
- 事件风险：低

操作建议：买入

【投资逻辑】
1. 基本面扎实：ROE连续5年>20%，盈利能力强
2. 业绩增长稳健：净利润增长16.2%，超预期
3. 技术面强势：多头排列，技术指标买入信号
4. 资金面支持：主力+北向持续流入
5. 估值合理：PE 35倍，处于合理区间上沿

【风险提示】
1. 估值不便宜：PE处于历史62%分位，短期上涨空间有限
2. 成长性放缓：增速低于行业平均，需关注增长动力
3. 市场波动：大盘调整时可能跟随回调

【操作策略】
- 建议仓位：20%-30%（中等仓位）
- 买入价位：1850-1875元
- 止损价位：1780元（跌破MA20）
- 目标价位：1950-2000元（上涨空间5%-10%）
- 持有周期：中长期（3-6个月）
```

### 4.8 用户故事与验收标准

**用户故事1**：
> 作为投资者，我希望快速了解一只股票的综合情况，以便决定是否买入。

**验收标准**：
- 报告生成时间<5秒
- 包含所有7个分析模块
- AI综合评分与操作建议清晰明确
- 分析结论附带数据依据

**用户故事2**：
> 作为技术分析爱好者，我希望看到详细的技术指标分析，以便判断买卖时机。

**验收标准**：
- 提供至少5个技术指标分析
- 标注关键支撑/压力位
- 给出技术面综合信号（买入/卖出/中性）
- 附带K线图与指标图表

**用户故事3**：
> 作为价值投资者，我希望深入了解公司的财务状况与估值水平，以便长期持有。

**验收标准**：
- 提供完整的财务健康度评分
- 分析ROE、毛利率等关键指标趋势
- 给出估值合理性判断（便宜/合理/贵）
- 与同行业公司对比

---

## 5. 自然语言自定义策略引擎

这是产品的**核心差异化功能**，让用户无需编程即可用中文描述选股条件，AI自动解析并执行策略。

### 5.1 功能概述

**核心价值**：
- 降低量化投资门槛：无需学习编程或SQL
- 提升策略创建效率：从数小时缩短到数分钟
- 支持复杂条件组合：多维度条件自由组合
- 智能理解模糊表达：AI理解"便宜的好公司"等模糊描述

**优先级**：P0（MVP核心功能）

### 5.2 输入方式与交互设计

**5.2.1 输入界面**（优先级：P0）

**界面元素**：
```
┌─────────────────────────────────────────────┐
│  自定义选股策略                              │
├─────────────────────────────────────────────┤
│  用中文描述你的选股条件：                    │
│  ┌─────────────────────────────────────────┐│
│  │ 找出PE低于15，ROE连续3年大于15%，      ││
│  │ 且近5日主力资金净流入的股票            ││
│  │                                         ││
│  └─────────────────────────────────────────┘│
│                                             │
│  💡 示例策略：                               │
│  • 筛选市值在100-500亿之间，近一个月涨幅   │
│    超过10%但RSI未超过70的科技股            │
│  • 帮我找最近发布业绩预增公告，且机构评级 │
│    为买入的股票                            │
│  • 找出北向资金连续5日流入，且PE低于行业  │
│    平均的白马股                            │
│                                             │
│  [解析策略]  [保存策略]  [查看历史策略]     │
└─────────────────────────────────────────────┘
```

**交互流程**：
1. 用户输入自然语言描述
2. 点击"解析策略"按钮
3. AI解析并展示结构化条件（用户确认）
4. 执行策略，展示选股结果
5. 可保存策略供后续使用

**5.2.2 典型输入示例**（优先级：P0）

**示例1：价值投资策略**
```
输入：找出PE低于15，ROE连续3年大于15%，且近5日主力资金净流入的股票

AI解析：
✓ 估值条件：PE < 15
✓ 盈利能力：ROE > 15%，持续3年
✓ 资金面：近5日主力资金净流入 > 0
✓ 风险控制：自动排除ST股、停牌股
```

**示例2：技术+基本面组合**
```
输入：筛选市值在100-500亿之间，近一个月涨幅超过10%但RSI未超过70的科技股

AI解析：
✓ 市值范围：100亿 ≤ 市值 ≤ 500亿
✓ 涨幅条件：近20日涨幅 > 10%
✓ 技术指标：RSI(14) < 70
✓ 行业筛选：科技行业（申万一级：电子、计算机、通信）
✓ 风险控制：自动排除ST股、停牌股
```

**示例3：事件驱动策略**
```
输入：帮我找最近发布业绩预增公告，且机构评级为买入的股票

AI解析：
✓ 公告类型：业绩预增公告
✓ 公告时间：近30日内
✓ 机构评级：买入/强烈买入
✓ 评级时间：近90日内
✓ 风险控制：自动排除ST股、停牌股
```

**示例4：模糊表达理解**
```
输入：找出便宜的好公司

AI解析（智能理解）：
✓ "便宜"理解为：PE < 20，PB < 3，低于行业平均估值
✓ "好公司"理解为：ROE > 15%，负债率 < 50%，连续盈利3年
✓ 补充条件：市值 > 50亿（避免小盘股风险）
✓ 风险控制：自动排除ST股、停牌股

⚠️ AI提示：我理解"便宜的好公司"为低估值+高盈利能力的股票，
   如果不符合你的预期，请提供更具体的条件。
```

### 5.3 AI解析流程

**5.3.1 解析流程架构**（优先级：P0）

```
用户输入自然语言
    ↓
【步骤1】意图识别
    ↓
【步骤2】实体提取
    ↓
【步骤3】条件结构化
    ↓
【步骤4】参数映射
    ↓
【步骤5】冲突检测
    ↓
【步骤6】用户确认
    ↓
【步骤7】数据查询执行
    ↓
选股结果输出
```

**5.3.2 意图识别**（优先级：P0）

**识别类型**：
- 选股意图：找出、筛选、帮我找
- 分析意图：分析、评估、判断
- 对比意图：对比、比较、哪个更好

**示例**：
```
输入："找出PE低于15的股票"
意图：选股
动作：执行筛选查询

输入："分析贵州茅台的投资价值"
意图：个股分析
动作：跳转到个股分析模块
```

**5.3.3 实体提取**（优先级：P0）

**实体类型**：

| 实体类型 | 示例 | 提取规则 |
|---------|------|---------|
| 财务指标 | PE、ROE、负债率 | 关键词匹配+同义词识别 |
| 技术指标 | MACD、RSI、均线 | 关键词匹配 |
| 数值范围 | 低于15、大于20%、100-500亿 | 正则表达式提取 |
| 时间范围 | 近5日、连续3年、最近一个月 | 时间表达式解析 |
| 行业板块 | 科技股、白酒、新能源 | 行业词典匹配 |
| 资金指标 | 主力资金、北向资金、融资余额 | 关键词匹配 |
| 事件类型 | 业绩预增、股东增持、分红 | 事件词典匹配 |

**提取示例**：
```
输入："找出PE低于15，ROE连续3年大于15%的股票"

提取结果：
- 财务指标：PE、ROE
- 数值范围：<15、>15%
- 时间范围：连续3年
```

**5.3.4 条件结构化**（优先级：P0）

**结构化格式**（JSON）：
```json
{
  "strategy_name": "用户自定义策略_20260212_001",
  "conditions": [
    {
      "type": "valuation",
      "field": "pe_ttm",
      "operator": "<",
      "value": 15,
      "description": "市盈率低于15倍"
    },
    {
      "type": "profitability",
      "field": "roe",
      "operator": ">",
      "value": 0.15,
      "duration": "3_years",
      "description": "ROE连续3年大于15%"
    },
    {
      "type": "capital_flow",
      "field": "main_capital_inflow",
      "operator": ">",
      "value": 0,
      "period": "5_days",
      "description": "近5日主力资金净流入"
    }
  ],
  "risk_filters": {
    "exclude_st": true,
    "exclude_suspended": true,
    "min_market_cap": 5000000000,
    "min_turnover": 50000000
  }
}
```

**5.3.5 参数映射**（优先级：P0）

**映射规则**：

| 自然语言表达 | 数据库字段 | 数据类型 | 单位 |
|-------------|-----------|---------|------|
| PE、市盈率 | pe_ttm | float | 倍 |
| PB、市净率 | pb | float | 倍 |
| ROE、净资产收益率 | roe | float | % |
| 负债率 | debt_ratio | float | % |
| 市值 | market_cap | bigint | 元 |
| 涨幅 | pct_change | float | % |
| 主力资金 | main_capital_inflow | bigint | 元 |
| 北向资金 | northbound_capital | bigint | 元 |
| RSI | rsi_14 | float | 0-100 |
| MACD | macd_dif, macd_dea | float | - |

**时间表达式映射**：
- "近5日" → 5个交易日
- "近一个月" → 20个交易日
- "连续3年" → 12个季度
- "最近" → 默认30日

**5.3.6 冲突检测与处理**（优先级：P1）

**冲突类型**：

**类型1：逻辑冲突**
```
输入："找出PE低于10且高于20的股票"

检测：PE < 10 AND PE > 20（逻辑矛盾）

处理：
⚠️ 检测到条件冲突：PE不能同时低于10且高于20
建议：请修改为"PE在10-20之间"或选择其中一个条件
```

**类型2：范围冲突**
```
输入："找出小盘股且市值大于1000亿的股票"

检测：小盘股（<100亿）与市值>1000亿冲突

处理：
⚠️ 检测到条件冲突：小盘股通常指市值<100亿，与"市值>1000亿"矛盾
建议：请明确市值范围，或删除"小盘股"限制
```

**类型3：过度筛选**
```
输入："找出PE<5，ROE>50%，市值>5000亿的股票"

检测：条件过于严格，预计结果<5只

处理：
⚠️ 条件可能过于严格，预计筛选结果较少
建议：放宽部分条件，如PE<10或ROE>30%
是否继续执行？[是] [调整条件]
```

**类型4：条件缺失**
```
输入："找出好股票"

检测：条件过于模糊，缺少具体指标

处理：
⚠️ 条件过于模糊，请补充具体条件：
• 估值要求（如PE<20）
• 盈利要求（如ROE>15%）
• 成长要求（如净利润增长>10%）
• 或选择内置策略：[格雷厄姆价值投资] [巴菲特护城河]
```

### 5.4 策略管理功能

**5.4.1 保存策略**（优先级：P0）

**保存信息**：
- 策略名称：用户自定义或AI生成
- 策略描述：自然语言原文
- 结构化条件：JSON格式
- 创建时间：时间戳
- 执行次数：统计数据
- 最近执行时间：时间戳

**保存界面**：
```
┌─────────────────────────────────────┐
│  保存策略                            │
├─────────────────────────────────────┤
│  策略名称：                          │
│  [低估值高ROE策略_______________]   │
│                                     │
│  策略描述：                          │
│  找出PE低于15，ROE连续3年大于15%，  │
│  且近5日主力资金净流入的股票        │
│                                     │
│  [保存]  [取消]                     │
└─────────────────────────────────────┘
```

**5.4.2 编辑策略**（优先级：P1）

**编辑方式**：
- 方式1：修改自然语言描述，重新解析
- 方式2：直接修改结构化条件（高级用户）

**编辑界面**：
```
┌─────────────────────────────────────┐
│  编辑策略：低估值高ROE策略           │
├─────────────────────────────────────┤
│  自然语言描述：                      │
│  [找出PE低于15，ROE连续3年大于15%] │
│                                     │
│  结构化条件：                        │
│  ✓ PE < 15                          │
│  ✓ ROE > 15%（连续3年）             │
│  ✓ 主力资金净流入（近5日）          │
│                                     │
│  [添加条件]  [删除条件]  [保存]     │
└─────────────────────────────────────┘
```

**5.4.3 分享策略**（优先级：P2）

**分享方式**：
- 生成分享链接：包含策略JSON
- 导出为文件：JSON/CSV格式
- 社区分享：发布到策略广场（Phase 3功能）

**分享界面**：
```
┌─────────────────────────────────────┐
│  分享策略：低估值高ROE策略           │
├─────────────────────────────────────┤
│  分享链接：                          │
│  https://app.com/strategy/abc123    │
│  [复制链接]                         │
│                                     │
│  导出文件：                          │
│  [导出JSON]  [导出CSV]              │
│                                     │
│  发布到社区：                        │
│  [发布到策略广场]                   │
└─────────────────────────────────────┘
```

**5.4.4 策略执行历史**（优先级：P1）

**记录内容**：
- 执行时间：时间戳
- 筛选结果数量：N只股票
- 结果快照：股票代码列表
- 后续表现：平均涨跌幅（T+5、T+10、T+20）

**历史界面**：
```
┌─────────────────────────────────────────────┐
│  策略执行历史：低估值高ROE策略               │
├─────────────────────────────────────────────┤
│  执行时间        结果数  T+5涨幅  T+10涨幅  │
│  2026-02-12     35只    +3.2%    +5.8%     │
│  2026-02-05     42只    +2.1%    +4.5%     │
│  2026-01-29     38只    +1.8%    +3.2%     │
│                                             │
│  平均表现：                                  │
│  - T+5涨幅：+2.4%（跑赢大盘1.2%）           │
│  - T+10涨幅：+4.5%（跑赢大盘2.1%）          │
│  - 胜率：68%（上涨概率）                    │
└─────────────────────────────────────────────┘
```

### 5.5 高级功能

**5.5.1 条件组合逻辑**（优先级：P1）

**支持逻辑运算符**：
- AND（且）：所有条件同时满足
- OR（或）：任一条件满足即可
- NOT（非）：排除某些条件

**示例**：
```
输入："找出（PE<15 且 ROE>15%）或（PB<2 且 股息率>3%）的股票"

解析：
(PE < 15 AND ROE > 15%) OR (PB < 2 AND 股息率 > 3%)

结果：满足任一组合的股票
```

**5.5.2 动态参数调整**（优先级：P2）

**参数滑块**：
```
┌─────────────────────────────────────┐
│  调整策略参数                        │
├─────────────────────────────────────┤
│  PE阈值：                            │
│  [====●=====] 15倍                  │
│  5倍 ←──────────→ 30倍              │
│                                     │
│  ROE阈值：                           │
│  [=======●==] 15%                   │
│  5% ←──────────→ 30%                │
│                                     │
│  时间周期：                          │
│  [===●=======] 3年                  │
│  1年 ←──────────→ 10年              │
│                                     │
│  [重新筛选]  [恢复默认]             │
└─────────────────────────────────────┘
```

**5.5.3 策略回测**（优先级：P2，Phase 3功能）

**回测功能**：
- 历史回测：模拟过去N个月执行策略的效果
- 收益曲线：展示策略收益率曲线
- 风险指标：最大回撤、夏普比率、胜率

**回测界面**：
```
┌─────────────────────────────────────────────┐
│  策略回测：低估值高ROE策略                   │
├─────────────────────────────────────────────┤
│  回测周期：2025-01-01 至 2026-02-12         │
│  调仓频率：每月1次                           │
│  持仓数量：20只                              │
│                                             │
│  回测结果：                                  │
│  - 累计收益率：+28.5%                       │
│  - 年化收益率：+25.2%                       │
│  - 最大回撤：-12.3%                         │
│  - 夏普比率：1.85                           │
│  - 胜率：72%                                │
│                                             │
│  vs 沪深300：                               │
│  - 超额收益：+15.2%                         │
│  - 跑赢概率：83%                            │
│                                             │
│  [查看详细报告]  [导出回测数据]             │
└─────────────────────────────────────────────┘
```

### 5.6 用户故事与验收标准

**用户故事1**：
> 作为散户投资者，我希望用中文描述选股条件，无需学习编程，以便快速找到符合我投资理念的股票。

**验收标准**：
- 支持纯中文输入
- AI解析准确率>90%
- 解析时间<3秒
- 展示结构化条件供用户确认
- 执行策略并返回结果

**用户故事2**：
> 作为量化爱好者，我希望保存和管理我的自定义策略，以便定期执行并追踪效果。

**验收标准**：
- 支持保存策略（名称+描述+条件）
- 支持编辑已保存策略
- 支持查看策略执行历史
- 记录策略后续表现（T+5、T+10涨跌幅）

**用户故事3**：
> 作为专业投资者，我希望AI能理解复杂的条件组合，以便实现精细化选股。

**验收标准**：
- 支持AND/OR/NOT逻辑运算
- 支持多维度条件组合（基本面+技术面+资金面）
- 支持嵌套条件（括号优先级）
- 冲突检测并提示用户

**用户故事4**：
> 作为谨慎的投资者，我希望在执行策略前看到AI的理解结果，以便确认是否符合我的意图。

**验收标准**：
- 解析后展示结构化条件
- 用户可修改或确认
- 检测到冲突时提示用户
- 条件过于严格时给出建议

---

## 6. AI分析引擎架构

### 6.1 LLM选型方案

**6.1.1 模型选型矩阵**（优先级：P0）

| 场景 | 推荐模型 | 理由 | 成本 | 备选方案 |
|------|---------|------|------|---------|
| 自然语言策略解析 | GPT-4 Turbo / Claude 3.5 Sonnet | 理解能力强，支持复杂逻辑 | 中 | DeepSeek-V3 |
| 个股分析报告生成 | GPT-4 Turbo / Claude 3.5 Sonnet | 长文本生成，专业表达 | 中 | Qwen2.5-72B |
| 快速问答 | GPT-3.5 Turbo / Claude 3 Haiku | 响应快，成本低 | 低 | GLM-4 |
| 财务数据分析 | GPT-4 Turbo | 数值计算准确 | 中 | Claude 3.5 Sonnet |
| 情感分析（新闻/公告） | 国产模型（Qwen/GLM） | 中文理解好，成本低 | 低 | GPT-3.5 |

**6.1.2 模型选型建议**（优先级：P0）

**方案A：纯国际模型**
- 主力：GPT-4 Turbo（OpenAI）
- 备用：Claude 3.5 Sonnet（Anthropic）
- 优势：能力最强，稳定性高
- 劣势：成本高，需科学上网
- 适用：海外用户或预算充足

**方案B：国产+国际混合**（推荐）
- 核心分析：GPT-4 Turbo / Claude 3.5 Sonnet
- 策略解析：DeepSeek-V3（国产，性价比高）
- 快速问答：Qwen2.5-72B（国产，免费API）
- 情感分析：GLM-4（国产，中文优势）
- 优势：成本可控，合规性好
- 劣势：需维护多模型接口
- 适用：国内用户，推荐方案

**方案C：纯国产模型**
- 主力：DeepSeek-V3
- 备用：Qwen2.5-72B、GLM-4
- 优势：成本最低，合规无忧
- 劣势：能力略逊国际模型
- 适用：预算有限或合规要求高

**MVP阶段推荐**：方案B（国产+国际混合）

### 6.2 Prompt工程设计

**6.2.1 金融领域专业提示词模板**（优先级：P0）

**模板1：自然语言策略解析**
```
你是一位资深的量化投资专家，擅长将自然语言描述转化为结构化的选股条件。

用户输入：{user_input}

任务：
1. 识别用户意图（选股/分析/对比）
2. 提取关键实体（财务指标、技术指标、数值范围、时间范围、行业板块）
3. 将条件转化为结构化JSON格式
4. 检测逻辑冲突并给出建议

输出格式：
{
  "intent": "选股",
  "conditions": [...],
  "conflicts": [...],
  "suggestions": [...]
}

注意事项：
- 对于模糊表达（如"便宜的好公司"），给出合理的默认解释并标注
- 检测逻辑冲突（如PE<10且PE>20）
- 自动添加风险控制条件（排除ST股、停牌股）
```

**模板2：个股基本面分析**
```
你是一位资深的价值投资分析师，擅长分析上市公司的基本面。

股票信息：
- 股票代码：{stock_code}
- 股票名称：{stock_name}
- 所属行业：{industry}

财务数据：
{financial_data}

任务：
1. 评估财务健康度（盈利能力、偿债能力、成长能力、运营能力、现金流）
2. 分析盈利能力趋势（ROE、毛利率、净利率）
3. 评估成长性（营收/净利润CAGR）
4. 判断估值合理性（PE/PB分位、PEG、DCF）

输出格式：
- 财务健康度评分：X分（0-100）
- 盈利能力趋势：上升/稳定/下降
- 成长性分类：高成长/稳健成长/低速成长/停滞/衰退
- 估值判断：便宜/合理/偏高/高估

注意事项：
- 使用专业术语但保持通俗易懂
- 每个结论必须附带数据依据
- 指出潜在风险点
```

**模板3：技术面分析**
```
你是一位资深的技术分析师，擅长解读K线图和技术指标。

股票信息：
- 股票代码：{stock_code}
- 当前价：{current_price}

技术数据：
- 均线系统：{ma_data}
- 技术指标：{indicators}
- 成交量：{volume_data}

任务：
1. 判断当前趋势（强势上涨/弱势上涨/横盘整理/弱势下跌/强势下跌）
2. 识别关键支撑/压力位
3. 综合技术指标给出买卖信号
4. 提供操作建议（买入/持有/观望/卖出）

输出格式：
- 当前趋势：{趋势判断}
- 关键价格位：支撑X元，压力Y元
- 技术信号：买入/卖出/中性（强度0-100%）
- 操作建议：{具体建议}

注意事项：
- 技术分析不是绝对的，需结合基本面
- 标注信号强度和可信度
```

**模板4：综合评估与操作建议**
```
你是一位资深的投资顾问，需要综合基本面、技术面、资金面、消息面给出投资建议。

股票信息：{stock_info}
基本面分析：{fundamental_analysis}
技术面分析：{technical_analysis}
资金面分析：{capital_flow_analysis}
消息面分析：{news_analysis}

任务：
1. 计算综合评分（1-10分）
2. 评估风险等级（低/中/高）
3. 给出操作建议（买入/持有/观望/卖出）
4. 总结投资逻辑
5. 列出风险提示
6. 提供操作策略（仓位、买入价、止损价、目标价）

输出格式：
- 综合评分：X.X分
- 风险等级：低/中/高
- 操作建议：买入/持有/观望/卖出
- 投资逻辑：[3-5条要点]
- 风险提示：[2-3条风险]
- 操作策略：仓位X%，买入价Y元，止损价Z元，目标价W元

注意事项：
- 必须包含免责声明：本分析仅供参考，不构成投资建议
- 风险提示必须明确具体
- 操作策略需考虑风险收益比
```

**6.2.2 Prompt优化策略**（优先级：P1）

**策略1：Few-Shot Learning**
- 在Prompt中提供2-3个示例
- 示例包含输入和期望输出
- 提升模型理解准确率

**策略2：Chain-of-Thought**
- 要求模型逐步推理
- 输出中间思考过程
- 提升复杂分析的准确性

**策略3：Self-Consistency**
- 同一问题生成多个答案
- 选择最一致的结果
- 提升结果稳定性

**策略4：动态Prompt调整**
- 根据用户反馈调整Prompt
- A/B测试不同Prompt版本
- 持续优化Prompt效果

### 6.3 RAG架构设计

**6.3.1 RAG整体架构**（优先级：P0）

```
┌─────────────────────────────────────────────┐
│  用户查询：分析贵州茅台的投资价值            │
└─────────────────┬───────────────────────────┘
                  ↓
┌─────────────────────────────────────────────┐
│  查询理解与路由                              │
│  - 识别股票代码：600519                      │
│  - 分析类型：综合分析                        │
│  - 需要的数据：基本面+技术面+资金面+消息面   │
└─────────────────┬───────────────────────────┘
                  ↓
┌─────────────────────────────────────────────┐
│  数据检索层（并行检索）                      │
│  ┌─────────────┐  ┌─────────────┐          │
│  │ 实时行情数据 │  │ 财务数据    │          │
│  └─────────────┘  └─────────────┘          │
│  ┌─────────────┐  ┌─────────────┐          │
│  │ 技术指标数据 │  │ 资金流向数据│          │
│  └─────────────┘  └─────────────┘          │
│  ┌─────────────┐  ┌─────────────┐          │
│  │ 公告新闻数据 │  │ 行业数据    │          │
│  └─────────────┘  └─────────────┘          │
└─────────────────┬───────────────────────────┘
                  ↓
┌─────────────────────────────────────────────┐
│  上下文构建                                  │
│  - 数据清洗与格式化                          │
│  - 计算衍生指标                              │
│  - 构建结构化上下文                          │
└─────────────────┬───────────────────────────┘
                  ↓
┌─────────────────────────────────────────────┐
│  LLM推理                                     │
│  - 注入上下文到Prompt                        │
│  - 调用LLM生成分析                           │
│  - 后处理与格式化                            │
└─────────────────┬───────────────────────────┘
                  ↓
┌─────────────────────────────────────────────┐
│  结果输出：个股分析报告                      │
└─────────────────────────────────────────────┘
```

**6.3.2 向量数据库选型**（优先级：P1）

**用途**：存储和检索非结构化数据（公告、新闻、研报）

| 数据库 | 优势 | 劣势 | 推荐场景 |
|--------|------|------|---------|
| Pinecone | 托管服务，易用 | 成本高 | 快速上线 |
| Weaviate | 开源，功能全 | 部署复杂 | 自建服务 |
| Milvus | 高性能，开源 | 学习曲线陡 | 大规模数据 |
| Qdrant | 轻量，Rust编写 | 生态较小 | 中小规模 |

**MVP推荐**：Qdrant（轻量、易部署）

**6.3.3 数据检索策略**（优先级：P0）

**策略1：结构化数据检索**
- 数据源：PostgreSQL + InfluxDB
- 检索方式：SQL查询
- 适用：财务数据、行情数据、技术指标

**策略2：向量检索**
- 数据源：Qdrant向量数据库
- 检索方式：语义相似度搜索
- 适用：公告、新闻、研报

**策略3：混合检索**
- 结合结构化查询和向量检索
- 先用SQL筛选候选集，再用向量检索排序
- 适用：复杂查询场景

**6.3.4 上下文窗口管理**（优先级：P1）

**问题**：LLM上下文窗口有限（GPT-4 Turbo: 128K tokens）

**解决方案**：
1. **数据压缩**：只传递关键数据，过滤冗余信息
2. **分层分析**：先分析各维度，再综合汇总
3. **增量更新**：只传递变化的数据
4. **摘要技术**：对长文本（公告、新闻）先生成摘要

**示例**：
```
原始财务数据：5000 tokens
压缩后：500 tokens（只保留关键指标+趋势）

原始公告：10篇×2000 tokens = 20000 tokens
压缩后：10篇×200 tokens = 2000 tokens（摘要）
```

### 6.4 Agent架构设计

**6.4.1 多Agent协作架构**（优先级：P1）

```
┌─────────────────────────────────────────────┐
│  主控Agent（Orchestrator）                   │
│  - 任务分解                                  │
│  - Agent调度                                 │
│  - 结果汇总                                  │
└─────────────────┬───────────────────────────┘
                  ↓
    ┌─────────────┼─────────────┐
    ↓             ↓             ↓
┌─────────┐  ┌─────────┐  ┌─────────┐
│数据获取  │  │策略执行  │  │分析报告  │
│Agent    │  │Agent    │  │Agent    │
└─────────┘  └─────────┘  └─────────┘
    ↓             ↓             ↓
┌─────────────────────────────────────┐
│  共享数据层（Redis + PostgreSQL）    │
└─────────────────────────────────────┘
```

**6.4.2 Agent职责划分**（优先级：P1）

**Agent 1：数据获取Agent**
- 职责：从数据源获取实时数据
- 输入：股票代码、数据类型
- 输出：结构化数据
- 工具：AKShare API、Tushare API、数据库查询

**Agent 2：策略执行Agent**
- 职责：执行选股策略，筛选股票
- 输入：策略条件（结构化JSON）
- 输出：符合条件的股票列表
- 工具：SQL查询、数据过滤、排序

**Agent 3：基本面分析Agent**
- 职责：分析公司财务状况
- 输入：股票代码、财务数据
- 输出：基本面分析报告
- 工具：LLM推理、财务指标计算

**Agent 4：技术面分析Agent**
- 职责：分析技术指标和趋势
- 输入：股票代码、K线数据、技术指标
- 输出：技术面分析报告
- 工具：LLM推理、技术指标计算

**Agent 5：资金面分析Agent**
- 职责：分析资金流向和筹码分布
- 输入：股票代码、资金流向数据
- 输出：资金面分析报告
- 工具：LLM推理、资金流向计算

**Agent 6：消息面分析Agent**
- 职责：分析公告、新闻、政策
- 输入：股票代码、公告、新闻
- 输出：消息面分析报告
- 工具：LLM推理、情感分析、向量检索

**Agent 7：综合评估Agent**
- 职责：汇总各维度分析，给出综合建议
- 输入：各Agent的分析报告
- 输出：综合评估报告+操作建议
- 工具：LLM推理、评分模型

**6.4.3 Agent通信机制**（优先级：P1）

**方案A：消息队列**
- 技术：RabbitMQ / Redis Pub/Sub
- 优势：解耦、异步、可扩展
- 劣势：复杂度高
- 适用：大规模并发

**方案B：直接调用**
- 技术：函数调用 / HTTP API
- 优势：简单、同步、易调试
- 劣势：耦合度高
- 适用：MVP阶段（推荐）

**MVP推荐**：方案B（直接调用）

### 6.5 结果可解释性设计

**6.5.1 分析结论附带推理过程**（优先级：P0）

**示例**：
```
【结论】：建议买入

【推理过程】：
1. 基本面评分：8.5分
   - ROE 22.3% > 15%（优秀）✓
   - 负债率 28.5% < 50%（健康）✓
   - 净利润增长 16.2% > 10%（稳健）✓

2. 技术面评分：9.0分
   - 多头排列（MA5>MA10>MA20>MA60）✓
   - MACD金叉（DIF>DEA）✓
   - RSI 65（强势但未超买）✓

3. 资金面评分：8.5分
   - 主力资金净流入 +8.5亿✓
   - 北向资金持续加仓✓

4. 估值评分：6.5分
   - PE 35倍，处于历史62%分位（合理偏高）⚠️

综合评分：8.2分 → 买入建议
```

**6.5.2 数据依据可追溯**（优先级：P0）

**要求**：
- 每个结论必须标注数据来源
- 提供数据时间戳
- 支持点击查看原始数据

**示例**：
```
ROE 22.3%
- 数据来源：2025年三季报
- 更新时间：2025-10-30
- [查看原始财报]
```

**6.5.3 置信度标注**（优先级：P1）

**置信度等级**：
- 高置信度（90%-100%）：基于确定性数据（财务报表）
- 中置信度（70%-89%）：基于统计分析（技术指标）
- 低置信度（50%-69%）：基于主观判断（市场情绪）

**示例**：
```
【技术面分析】置信度：85%（中高）
- 多头排列：确定性高（95%）
- MACD金叉：确定性高（90%）
- 趋势持续性：不确定性较高（70%）
```

### 6.6 模型微调与优化

**6.6.1 领域微调**（优先级：P2，Phase 3功能）

**微调数据**：
- 历史选股策略+结果
- 专业分析师的分析报告
- 用户反馈数据（点赞/点踩）

**微调目标**：
- 提升策略解析准确率
- 提升分析报告专业性
- 降低幻觉（Hallucination）

**6.6.2 强化学习优化**（优先级：P2，Phase 3功能）

**奖励函数**：
- 策略收益率：正收益+1，负收益-1
- 用户满意度：点赞+1，点踩-1
- 风险控制：最大回撤<15% +1

**优化目标**：
- 提升策略胜率
- 降低最大回撤
- 提升用户满意度

### 6.7 用户故事与验收标准

**用户故事1**：
> 作为投资者，我希望AI分析结论有理有据，以便信任AI的建议。

**验收标准**：
- 每个结论附带推理过程
- 推理过程包含具体数据
- 数据来源可追溯
- 标注置信度

**用户故事2**：
> 作为开发者，我希望AI分析引擎模块化，以便灵活扩展和维护。

**验收标准**：
- Agent职责清晰，单一职责
- Agent之间低耦合
- 支持独立测试和部署
- 易于添加新Agent

---

## 7. 用户交互与界面设计

### 7.1 信息架构

**7.1.1 核心页面清单**（优先级：P0）

```
应用首页
├── 选股中心
│   ├── 经典策略选股
│   ├── 自定义策略选股
│   └── 选股结果列表
├── 个股分析
│   ├── 股票搜索
│   ├── 分析报告
│   └── 对比分析
├── 我的策略
│   ├── 已保存策略
│   ├── 策略执行历史
│   └── 策略回测（Phase 2）
├── 市场概览
│   ├── 大盘指数
│   ├── 板块行情
│   └── 资金流向
└── 个人中心
    ├── 自选股
    ├── 持仓管理（Phase 3）
    └── 设置
```

**7.1.2 页面优先级**

| 页面 | 优先级 | 理由 |
|------|--------|------|
| 选股中心 | P0 | 核心功能 |
| 个股分析 | P0 | 核心功能 |
| 我的策略 | P0 | 核心功能 |
| 市场概览 | P1 | 辅助决策 |
| 个人中心 | P1 | 用户管理 |

### 7.2 关键用户流程

**7.2.1 选股流程**（优先级：P0）

```
用户进入选股中心
    ↓
选择策略类型
    ├─→ 经典策略
    │   ├─→ 选择策略（格雷厄姆/巴菲特/彼得·林奇等）
    │   ├─→ 调整参数（可选）
    │   ├─→ 执行策略
    │   └─→ 查看结果
    │
    └─→ 自定义策略
        ├─→ 输入自然语言描述
        ├─→ AI解析条件
        ├─→ 用户确认/修改
        ├─→ 执行策略
        └─→ 查看结果
            ↓
选股结果列表
    ├─→ 查看股票列表（代码、名称、价格、涨跌幅）
    ├─→ 排序/筛选
    ├─→ 点击股票 → 跳转个股分析
    └─→ 保存策略（可选）
```

**交互细节**：
- 策略执行时显示加载动画："正在筛选股票..."
- 结果展示：表格形式，支持排序（按涨跌幅、市值、PE等）
- 快速操作：点击股票代码快速跳转分析页面
- 保存策略：一键保存，下次快速执行

**7.2.2 个股分析流程**（优先级：P0）

```
用户进入个股分析页面
    ↓
输入股票代码/名称
    ↓
搜索股票（支持模糊搜索）
    ↓
选择股票
    ↓
AI生成分析报告（5-10秒）
    ├─→ 显示加载进度："正在分析基本面..."
    ├─→ 显示加载进度："正在分析技术面..."
    ├─→ 显示加载进度："正在分析资金面..."
    └─→ 显示加载进度："正在生成综合评估..."
    ↓
展示分析报告
    ├─→ 核心指标卡片（置顶）
    ├─→ 基本面分析
    ├─→ 技术面分析
    ├─→ 资金面分析
    ├─→ 消息面分析
    ├─→ 同行业对比
    └─→ AI综合评估
    ↓
用户操作
    ├─→ 加入自选股
    ├─→ 分享报告
    ├─→ 导出PDF
    └─→ 查看历史分析
```

**交互细节**：
- 搜索框：支持股票代码、名称、拼音首字母搜索
- 加载动画：分步骤显示分析进度，提升用户体验
- 报告展示：分模块折叠/展开，默认展开核心模块
- 快速导航：右侧锚点导航，快速跳转到各模块

**7.2.3 自定义策略流程**（优先级：P0）

```
用户进入自定义策略页面
    ↓
输入自然语言描述
    ↓
点击"解析策略"
    ↓
AI解析条件（2-3秒）
    ↓
展示结构化条件
    ├─→ 用户确认 → 执行策略
    ├─→ 用户修改 → 重新解析
    └─→ 检测到冲突 → 提示用户
    ↓
执行策略
    ↓
展示选股结果
    ↓
用户操作
    ├─→ 保存策略
    ├─→ 查看个股详情
    └─→ 调整参数重新筛选
```

**交互细节**：
- 输入框：多行文本框，支持换行
- 示例策略：点击示例自动填充输入框
- 条件展示：卡片形式，每个条件一个卡片，支持删除/编辑
- 冲突提示：红色警告框，明确指出冲突原因

### 7.3 界面设计规范

**7.3.1 设计风格**（优先级：P0）

**整体风格**：
- 专业、简洁、数据驱动
- 配色：深色主题（可选浅色主题）
- 字体：思源黑体（中文）+ Roboto（数字/英文）
- 布局：响应式设计，适配桌面/平板/手机

**配色方案**：
```
主色调：
- 主色：#1890FF（蓝色，专业、科技感）
- 辅助色：#52C41A（绿色，上涨）、#FF4D4F（红色，下跌）
- 背景色：#F0F2F5（浅色主题）、#141414（深色主题）
- 文字色：#262626（主文字）、#8C8C8C（次要文字）

功能色：
- 成功：#52C41A
- 警告：#FAAD14
- 错误：#FF4D4F
- 信息：#1890FF
```

**7.3.2 组件设计**（优先级：P0）

**组件1：股票卡片**
```
┌─────────────────────────────────────┐
│ 贵州茅台 (600519)          [+自选]  │
│ ¥1875.00  +2.5%  +45.00            │
├─────────────────────────────────────┤
│ 市值：2.3万亿  PE：35.2  PB：12.5  │
│ ROE：22.3%  涨幅(20日)：+8.5%      │
├─────────────────────────────────────┤
│ AI评分：8.2分  风险：中  建议：买入 │
└─────────────────────────────────────┘
```

**组件2：指标卡片**
```
┌─────────────────────────────────────┐
│ 财务健康度                          │
│ ━━━━━━━━━━━━━━━━━━ 85分           │
│                                     │
│ 盈利能力 ★★★★☆                     │
│ 偿债能力 ★★★★★                     │
│ 成长能力 ★★★☆☆                     │
└─────────────────────────────────────┘
```

**组件3：趋势图表**
```
┌─────────────────────────────────────┐
│ ROE趋势（近5年）                    │
│                                     │
│ 25% ┤                         ●     │
│ 20% ┤               ●     ●         │
│ 15% ┤       ●   ●                   │
│ 10% ┤   ●                           │
│  5% ┤                               │
│     └─────────────────────────────  │
│     2021 2022 2023 2024 2025        │
└─────────────────────────────────────┘
```

**组件4：操作建议卡片**
```
┌─────────────────────────────────────┐
│ 🎯 操作建议：买入                    │
├─────────────────────────────────────┤
│ 建议仓位：20%-30%                   │
│ 买入价位：1850-1875元               │
│ 止损价位：1780元                    │
│ 目标价位：1950-2000元               │
│ 持有周期：中长期（3-6个月）         │
└─────────────────────────────────────┘
```

### 7.4 数据可视化需求

**7.4.1 K线图**（优先级：P0）

**功能需求**：
- 支持日K、周K、月K、分钟K切换
- 支持前复权、后复权、不复权切换
- 叠加均线（MA5/10/20/60）
- 叠加成交量
- 支持缩放、拖拽
- 标注关键价格位（支撑/压力）

**技术方案**：
- 推荐库：ECharts / TradingView Lightweight Charts
- 数据格式：OHLCV（开高低收量）
- 更新频率：实时更新（交易时间）

**7.4.2 技术指标图**（优先级：P0）

**指标类型**：
- MACD：DIF、DEA、柱状图
- RSI：RSI线、超买超卖区域
- KDJ：K、D、J三线
- 布林带：上轨、中轨、下轨

**展示方式**：
- 与K线图联动
- 支持切换指标
- 标注买卖信号点

**7.4.3 财务图表**（优先级：P0）

**图表类型**：
- 柱状图：营收、净利润趋势（近5年）
- 折线图：ROE、毛利率、净利率趋势
- 饼图：营收结构、成本结构
- 雷达图：财务健康度多维评分

**7.4.4 资金流向图**（优先级：P1）

**图表类型**：
- 瀑布图：主力资金、超大单、大单、中单、小单流向
- 折线图：北向资金持仓变化
- 柱状图：融资融券余额变化

**7.4.5 行业对比图**（优先级：P1）

**图表类型**：
- 柱状图：关键指标横向对比（PE、ROE、增长率）
- 散点图：估值-成长矩阵（PE vs 增长率）
- 气泡图：市值-盈利能力-估值三维对比

### 7.5 响应式设计

**7.5.1 桌面端**（优先级：P0）

**布局**：
- 分辨率：1920×1080（主流）
- 布局：左侧导航栏 + 主内容区 + 右侧信息栏
- 导航栏：固定宽度200px
- 主内容区：自适应宽度
- 右侧信息栏：固定宽度300px（可折叠）

**交互**：
- 鼠标悬停：显示详细信息
- 快捷键：支持常用操作（搜索、刷新等）
- 多窗口：支持多标签页

**7.5.2 平板端**（优先级：P1）

**布局**：
- 分辨率：1024×768
- 布局：顶部导航栏 + 主内容区
- 导航栏：折叠为汉堡菜单
- 右侧信息栏：默认隐藏，点击展开

**交互**：
- 触摸操作：支持滑动、缩放
- 手势：左右滑动切换页面

**7.5.3 移动端**（优先级：P2，Phase 3功能）

**布局**：
- 分辨率：375×667（iPhone SE）
- 布局：单列布局
- 导航栏：底部Tab栏

**交互**：
- 触摸优化：按钮尺寸≥44px
- 简化操作：减少输入，增加选择
- 快速操作：下拉刷新、上拉加载

### 7.6 交互动效

**7.6.1 加载动效**（优先级：P0）

**场景1：数据加载**
- 骨架屏：展示页面结构，避免白屏
- 进度条：显示加载进度（0%-100%）
- 加载文案："正在加载数据..."

**场景2：AI分析**
- 分步骤进度："正在分析基本面..." → "正在分析技术面..." → "正在生成报告..."
- 进度百分比：25% → 50% → 75% → 100%
- 预计时间：不显示具体时间，只显示"即将完成"

**7.6.2 反馈动效**（优先级：P1）

**成功反馈**：
- 绿色对勾动画
- 提示文案："策略保存成功"
- 自动消失（3秒）

**错误反馈**：
- 红色叉号动画
- 提示文案："策略执行失败，请重试"
- 手动关闭或自动消失（5秒）

**7.6.3 过渡动效**（优先级：P2）

**页面切换**：
- 淡入淡出（Fade）
- 滑动（Slide）
- 缩放（Scale）

**元素展开/折叠**：
- 高度动画（Height Transition）
- 透明度动画（Opacity Transition）

### 7.7 无障碍设计

**7.7.1 视觉无障碍**（优先级：P1）

**色彩对比**：
- 文字与背景对比度≥4.5:1（WCAG AA标准）
- 重要信息不仅依赖颜色（如涨跌用颜色+箭头）

**字体大小**：
- 最小字体：14px（桌面端）、16px（移动端）
- 支持字体缩放（Ctrl + / Ctrl -）

**7.7.2 操作无障碍**（优先级：P2）

**键盘导航**：
- 支持Tab键切换焦点
- 支持Enter键确认操作
- 支持Esc键取消操作

**屏幕阅读器**：
- 图片添加alt属性
- 按钮添加aria-label
- 表格添加caption

### 7.8 用户故事与验收标准

**用户故事1**：
> 作为投资者，我希望界面简洁直观，以便快速找到我需要的功能。

**验收标准**：
- 核心功能入口明显（选股、分析）
- 导航清晰，层级不超过3层
- 常用功能≤3次点击可达

**用户故事2**：
> 作为数据分析爱好者，我希望看到丰富的图表，以便直观理解数据。

**验收标准**：
- 提供至少5种图表类型（K线、柱状图、折线图、饼图、雷达图）
- 图表支持交互（缩放、拖拽、悬停显示详情）
- 图表加载时间<2秒

**用户故事3**：
> 作为移动用户，我希望在手机上也能流畅使用，以便随时随地查看股票。

**验收标准**：
- 移动端适配（Phase 3）
- 触摸操作流畅
- 页面加载时间<3秒

---

## 8. 非功能性需求

### 8.1 性能要求

**8.1.1 响应时间**（优先级：P0）

| 操作类型 | 目标响应时间 | 最大可接受时间 | 备注 |
|---------|-------------|---------------|------|
| 页面加载 | <2秒 | <5秒 | 首屏渲染 |
| 股票搜索 | <500ms | <1秒 | 模糊搜索 |
| 选股策略执行 | <5秒 | <10秒 | 全市场筛选 |
| 个股分析报告生成 | <10秒 | <20秒 | AI分析 |
| 自然语言策略解析 | <3秒 | <5秒 | LLM推理 |
| 实时行情更新 | <3秒 | <5秒 | 交易时间 |
| K线图加载 | <2秒 | <3秒 | 含技术指标 |

**性能优化策略**：
- 数据缓存：Redis缓存热数据，命中率>90%
- CDN加速：静态资源使用CDN分发
- 懒加载：图表按需加载，非首屏内容延迟加载
- 分页加载：选股结果分页展示，每页20-50条
- 并行请求：多个独立数据源并行请求
- 预加载：预测用户行为，提前加载数据

**8.1.2 并发用户数**（优先级：P0）

**MVP阶段目标**：
- 同时在线用户：1000人
- 峰值QPS：500次/秒
- 数据库连接池：100个连接
- Redis连接池：50个连接

**Phase 2目标**：
- 同时在线用户：10000人
- 峰值QPS：5000次/秒
- 水平扩展：支持多实例部署

**压力测试要求**：
- 使用JMeter/Locust进行压力测试
- 模拟真实用户行为（浏览、搜索、分析）
- 测试场景：正常负载、峰值负载、压力测试
- 监控指标：响应时间、错误率、资源使用率

**8.1.3 数据库性能**（优先级：P0）

**查询性能**：
- 单表查询：<100ms
- 多表关联查询：<500ms
- 全市场筛选：<5秒
- 索引覆盖率：>90%

**优化策略**：
- 索引优化：为常用查询字段建立索引
- 分区表：按时间分区（日K线、财务数据）
- 读写分离：主库写入，从库读取
- 查询缓存：缓存常用查询结果

**8.1.4 AI推理性能**（优先级：P1）

**推理时间**：
- 策略解析：<3秒
- 个股分析：<10秒
- 批量分析：<30秒（10只股票）

**优化策略**：
- 模型选择：根据场景选择合适的模型（GPT-4 vs GPT-3.5）
- 批量推理：合并多个请求，减少API调用次数
- 结果缓存：相同查询缓存结果（TTL: 1小时）
- 异步处理：长时间任务异步执行，轮询结果

### 8.2 数据安全与隐私保护

**8.2.1 数据加密**（优先级：P0）

**传输加密**：
- HTTPS：所有API请求使用HTTPS
- TLS版本：TLS 1.2+
- 证书：使用受信任的CA证书

**存储加密**：
- 敏感数据：用户密码、API密钥使用AES-256加密
- 数据库：启用数据库透明加密（TDE）
- 备份：备份文件加密存储

**8.2.2 用户隐私保护**（优先级：P0）

**数据收集原则**：
- 最小化原则：只收集必要的用户数据
- 明确告知：隐私政策明确说明数据用途
- 用户同意：收集敏感数据需用户明确同意

**隐私保护措施**：
- 匿名化：用户行为数据匿名化处理
- 数据脱敏：日志中脱敏敏感信息（手机号、邮箱）
- 访问控制：严格控制数据访问权限
- 数据删除：用户可申请删除个人数据

**8.2.3 API安全**（优先级：P0）

**认证与授权**：
- JWT Token：用户认证使用JWT
- Token过期：Access Token 2小时，Refresh Token 7天
- 权限控制：基于角色的访问控制（RBAC）

**API防护**：
- 速率限制：每用户每分钟100次请求
- IP白名单：管理接口限制IP访问
- 参数校验：严格校验所有输入参数
- SQL注入防护：使用参数化查询
- XSS防护：输出内容转义

**8.2.4 数据备份**（优先级：P0）

**备份策略**：
- 全量备份：每日凌晨3:00全量备份
- 增量备份：每小时增量备份
- 异地备份：备份文件存储到异地机房
- 保留策略：全量备份保留30天，增量备份保留7天

**恢复测试**：
- 每月进行一次恢复演练
- 恢复时间目标（RTO）：<4小时
- 恢复点目标（RPO）：<1小时

### 8.3 系统可用性与容错设计

**8.3.1 可用性目标**（优先级：P0）

**SLA目标**：
- 系统可用性：99.5%（MVP）→ 99.9%（Phase 2）
- 每月允许停机时间：<3.6小时（MVP）→ <43分钟（Phase 2）
- 故障恢复时间：<30分钟

**8.3.2 容错设计**（优先级：P0）

**单点故障消除**：
- 应用服务器：多实例部署，负载均衡
- 数据库：主从复制，自动故障转移
- Redis：哨兵模式或集群模式
- 消息队列：集群部署

**降级策略**：
- AI分析降级：LLM不可用时，返回基于规则的分析
- 实时数据降级：实时数据不可用时，使用缓存数据+延迟标识
- 图表降级：图表加载失败时，展示表格数据

**熔断机制**：
- 外部API熔断：连续失败5次后熔断30秒
- 数据库熔断：响应时间>5秒时熔断
- 限流保护：超过QPS阈值时拒绝请求

**8.3.3 监控与告警**（优先级：P0）

**监控指标**：
- 系统指标：CPU、内存、磁盘、网络
- 应用指标：QPS、响应时间、错误率
- 业务指标：活跃用户数、策略执行次数、分析报告生成次数
- 数据指标：数据更新延迟、数据质量

**告警规则**：
- P0告警：系统不可用、数据库宕机、核心功能失败
- P1告警：响应时间>10秒、错误率>5%、数据更新延迟>1小时
- P2告警：CPU>80%、内存>85%、磁盘>90%

**告警通知**：
- 通知渠道：邮件、短信、钉钉/企业微信
- 通知对象：P0告警→所有人，P1告警→值班人员，P2告警→运维人员
- 告警升级：P0告警15分钟未处理自动升级

**8.3.4 日志管理**（优先级：P1）

**日志类型**：
- 访问日志：记录所有API请求
- 错误日志：记录所有异常和错误
- 业务日志：记录关键业务操作
- 审计日志：记录敏感操作（登录、修改配置）

**日志格式**：
- 结构化日志：JSON格式
- 必要字段：时间戳、日志级别、用户ID、请求ID、消息
- 敏感信息脱敏：密码、Token、手机号

**日志存储**：
- 本地存储：保留7天
- 集中存储：ELK/Loki，保留30天
- 归档存储：压缩后存储到对象存储，保留1年

### 8.4 可扩展性

**8.4.1 水平扩展**（优先级：P1）

**无状态设计**：
- 应用服务器：无状态，支持水平扩展
- Session管理：使用Redis存储Session
- 文件存储：使用对象存储（OSS/S3）

**负载均衡**：
- 应用层：Nginx/HAProxy负载均衡
- 数据库层：读写分离，读库负载均衡
- 缓存层：Redis集群，一致性哈希

**8.4.2 垂直扩展**（优先级：P2）

**资源升级**：
- CPU：支持多核并行处理
- 内存：支持大内存缓存
- 磁盘：支持SSD高速存储

**8.4.3 功能扩展**（优先级：P1）

**插件化架构**：
- 策略插件：支持自定义策略插件
- 数据源插件：支持接入新数据源
- 分析插件：支持自定义分析模块

**API扩展**：
- RESTful API：提供完整的API接口
- Webhook：支持事件通知
- SDK：提供Python/JavaScript SDK

**8.4.4 市场扩展**（优先级：P2，Phase 3功能）

**多市场支持**：
- 港股市场：接入港股数据源
- 美股市场：接入美股数据源
- 其他市场：预留扩展接口

**国际化**：
- 多语言：支持中文、英文
- 多时区：支持不同时区
- 多货币：支持不同货币单位

### 8.5 兼容性

**8.5.1 浏览器兼容性**（优先级：P0）

**支持的浏览器**：
- Chrome：最新版本及前2个版本
- Firefox：最新版本及前2个版本
- Safari：最新版本及前2个版本
- Edge：最新版本及前2个版本

**不支持的浏览器**：
- IE11及以下版本

**8.5.2 设备兼容性**（优先级：P1）

**桌面端**：
- Windows 10+
- macOS 10.15+
- Linux（主流发行版）

**移动端**（Phase 3）：
- iOS 14+
- Android 8+

**8.5.3 分辨率兼容性**（优先级：P0）

**支持的分辨率**：
- 桌面端：1366×768 ~ 3840×2160
- 平板端：768×1024 ~ 1024×1366
- 移动端：375×667 ~ 428×926

### 8.6 用户故事与验收标准

**用户故事1**：
> 作为用户，我希望系统响应快速，以便高效完成投资决策。

**验收标准**：
- 页面加载时间<2秒
- 选股策略执行<5秒
- 个股分析报告生成<10秒
- 实时行情更新<3秒

**用户故事2**：
> 作为用户，我希望我的数据安全可靠，以便放心使用系统。

**验收标准**：
- 所有API使用HTTPS
- 敏感数据加密存储
- 每日自动备份
- 隐私政策明确透明

**用户故事3**：
> 作为运维人员，我希望系统稳定可靠，以便减少故障处理工作。

**验收标准**：
- 系统可用性≥99.5%
- 故障自动告警
- 关键组件无单点故障
- 故障恢复时间<30分钟

---

## 9. 合规与风险声明

### 9.1 投资风险提示

**9.1.1 风险提示展示位置**（优先级：P0）

**必须展示的位置**：
1. 用户首次使用时：弹窗展示，用户必须阅读并同意
2. 个股分析报告：每份报告底部显著位置
3. 选股结果页面：页面顶部或底部
4. 操作建议处：紧跟操作建议后
5. 应用设置页面：独立的风险提示页面

**9.1.2 风险提示内容**（优先级：P0）

**标准风险提示文案**：
```
【重要风险提示】

1. 本应用提供的所有分析、评分、建议仅供参考，不构成任何投资建议。

2. 股市有风险，投资需谨慎。历史数据和AI分析不能保证未来收益。

3. 用户应根据自身风险承受能力、投资目标和财务状况独立做出投资决策。

4. 本应用不对用户的投资损失承担任何责任。

5. 用户在使用本应用进行投资决策前，应咨询专业的投资顾问。

6. 本应用的数据来源于第三方，我们尽力确保数据准确性，但不保证数据的完整性、准确性和及时性。

7. AI分析结果基于历史数据和统计模型，存在局限性，可能出现误判。

8. 市场环境、政策变化、突发事件等因素可能导致分析结果失效。

我已阅读并理解上述风险提示 [✓]
```

**9.1.3 风险等级标注**（优先级：P0）

**每只股票必须标注风险等级**：
- 低风险：蓝筹白马，财务稳健，估值合理
- 中风险：成长股，估值偏高，波动较大
- 高风险：题材股、ST股，财务风险高

**风险等级展示**：
```
┌─────────────────────────────────────┐
│ 风险等级：⚠️ 中风险                  │
├─────────────────────────────────────┤
│ 风险因素：                          │
│ • 估值偏高（PE处于历史62%分位）     │
│ • 成长性放缓（增速低于行业平均）    │
│ • 市场波动风险（Beta=0.85）         │
└─────────────────────────────────────┘
```

### 9.2 免责声明

**9.2.1 免责声明内容**（优先级：P0）

**完整免责声明**：
```
【免责声明】

一、服务性质
本应用是一款股票数据分析工具，旨在为用户提供数据查询、分析和参考服务。本应用不是证券投资咨询机构，不具备证券投资咨询资格。

二、信息来源
本应用的数据来源于公开市场数据和第三方数据提供商（包括但不限于AKShare、Tushare等）。我们尽力确保数据的准确性和及时性，但不对数据的完整性、准确性、及时性做任何明示或暗示的保证。

三、AI分析局限性
本应用使用人工智能技术进行数据分析和报告生成。AI分析结果基于历史数据和统计模型，存在以下局限性：
1. 无法预测突发事件和黑天鹅事件
2. 可能受训练数据偏差影响
3. 对市场情绪和非理性行为的判断有限
4. 可能出现误判或错误分析

四、投资建议声明
本应用提供的所有分析、评分、操作建议均为信息参考，不构成任何投资建议。用户应：
1. 独立判断和决策
2. 根据自身风险承受能力投资
3. 咨询专业投资顾问
4. 对自己的投资决策负责

五、责任限制
1. 本应用不对用户的投资损失承担任何责任
2. 本应用不对数据错误、延迟、中断导致的损失负责
3. 本应用不对AI分析错误导致的损失负责
4. 本应用不对第三方数据源的问题负责

六、合规声明
本应用严格遵守中国证监会相关规定：
1. 不提供具体买卖时点建议
2. 不承诺收益或保本
3. 不代客理财
4. 不收取投资咨询费用

七、用户责任
用户使用本应用即表示：
1. 已阅读并理解本免责声明
2. 同意自行承担投资风险
3. 不会因投资损失向本应用追责
4. 理解股市投资的风险性

八、法律适用
本免责声明适用中华人民共和国法律。如有争议，由本应用所在地人民法院管辖。

最后更新时间：2026-02-12
```

**9.2.2 免责声明展示**（优先级：P0）

**展示位置**：
- 用户注册/首次使用：必须阅读并同意
- 应用底部：链接到完整免责声明
- 关于页面：完整展示免责声明
- 个股分析报告：简化版免责声明

### 9.3 数据来源合规性

**9.3.1 数据来源声明**（优先级：P0）

**数据来源说明**：
```
【数据来源】

本应用使用的数据来源包括：

1. AKShare（开源数据接口）
   - 数据类型：A股行情、财务数据、资金流向
   - 数据更新：实时/T+1
   - 免责：数据仅供参考，不保证准确性

2. Tushare Pro（商业数据服务）
   - 数据类型：深度财务数据、分钟级行情
   - 数据更新：实时/T+1
   - 授权：已获得合法使用授权

3. BaoStock（开源数据平台）
   - 数据类型：历史K线、复权数据
   - 数据更新：T+1
   - 免责：数据仅供参考，不保证准确性

4. 公开市场数据
   - 数据类型：公告、新闻、政策
   - 数据来源：交易所官网、证监会官网

所有数据来源均为合法公开数据，不涉及内幕信息或非法获取。
```

**9.3.2 数据使用合规**（优先级：P0）

**合规要求**：
1. 不转售数据：不将原始数据转售给第三方
2. 不用于非法用途：不用于内幕交易、操纵市场等
3. 尊重版权：遵守数据提供商的使用协议
4. 数据脱敏：用户数据不与市场数据混合

### 9.4 符合中国证监会相关规定

**9.4.1 禁止行为**（优先级：P0）

**严格禁止以下行为**：
1. ❌ 提供具体买卖时点建议（如"明天9:30买入"）
2. ❌ 承诺收益率（如"年化收益30%"）
3. ❌ 保本承诺（如"保证不亏损"）
4. ❌ 代客理财（不接触用户资金）
5. ❌ 收取投资咨询费用（工具使用费除外）
6. ❌ 推荐具体股票并收费（免费推荐需加风险提示）
7. ❌ 使用"稳赚"、"必涨"等绝对化用语
8. ❌ 展示虚假业绩或误导性信息

**9.4.2 合规表达规范**（优先级：P0）

**操作建议表达规范**：
```
❌ 错误表达：
- "明天开盘买入贵州茅台"
- "该股票必涨，赶紧买入"
- "保证年化收益30%"

✅ 正确表达：
- "综合分析显示该股票具有投资价值，建议关注"
- "基于历史数据分析，该股票风险收益比较好，仅供参考"
- "操作建议：买入（风险提示：股市有风险，投资需谨慎）"
```

**评分表达规范**：
```
❌ 错误表达：
- "该股票评分10分，必涨无疑"
- "AI预测该股票将上涨50%"

✅ 正确表达：
- "综合评分8.2分（满分10分），仅供参考"
- "基于历史数据分析，该股票表现较好，但不保证未来收益"
```

**9.4.3 资质声明**（优先级：P0）

**资质声明内容**：
```
【资质声明】

本应用为股票数据分析工具，不具备以下资质：
1. 证券投资咨询资格
2. 基金销售资格
3. 证券经纪业务资格
4. 资产管理资格

本应用不提供：
1. 证券投资咨询服务
2. 代客理财服务
3. 证券交易服务
4. 资产管理服务

本应用仅提供：
1. 数据查询服务
2. 数据分析服务
3. 信息参考服务
4. 工具使用服务
```

### 9.5 用户协议

**9.5.1 用户协议内容**（优先级：P0）

**核心条款**：
```
【用户协议】

一、服务内容
1. 本应用提供股票数据查询、分析和参考服务
2. 用户可使用内置策略或自定义策略进行选股
3. 用户可查看个股分析报告
4. 用户可保存和管理自己的策略

二、用户权利
1. 免费使用基础功能
2. 查看和导出分析报告
3. 保存和管理个人策略
4. 随时停止使用服务

三、用户义务
1. 提供真实、准确的注册信息
2. 妥善保管账号和密码
3. 不得将账号转让或出借他人
4. 不得利用本应用从事违法活动
5. 不得恶意攻击或破坏系统
6. 不得批量抓取数据用于商业用途

四、服务限制
1. 本应用保留随时修改或终止服务的权利
2. 本应用可能因维护、升级等原因暂停服务
3. 本应用可能对恶意用户限制或终止服务

五、知识产权
1. 本应用的所有内容（包括但不限于软件、界面、文字、图片）归本应用所有
2. 用户不得复制、修改、传播本应用的内容
3. 用户创建的策略归用户所有

六、隐私保护
1. 本应用尊重用户隐私
2. 用户数据仅用于提供服务
3. 不会向第三方出售用户数据
4. 详见《隐私政策》

七、争议解决
1. 本协议适用中华人民共和国法律
2. 如有争议，由本应用所在地人民法院管辖

八、协议变更
1. 本应用有权随时修改本协议
2. 修改后的协议将在应用内公布
3. 用户继续使用即视为同意修改后的协议

最后更新时间：2026-02-12
```

**9.5.2 隐私政策**（优先级：P0）

**核心内容**：
```
【隐私政策】

一、信息收集
我们收集以下信息：
1. 注册信息：邮箱、用户名（不收集手机号、身份证）
2. 使用信息：访问日志、操作记录、策略执行记录
3. 设备信息：IP地址、浏览器类型、操作系统

二、信息使用
我们使用信息用于：
1. 提供和改进服务
2. 分析用户行为，优化产品
3. 发送服务通知（不发送营销信息）
4. 防止欺诈和滥用

三、信息保护
我们采取以下措施保护信息：
1. 数据加密存储
2. 访问权限控制
3. 定期安全审计
4. 员工保密协议

四、信息共享
我们不会向第三方出售或出租用户信息。
以下情况除外：
1. 获得用户明确同意
2. 法律法规要求
3. 保护用户或公众安全

五、Cookie使用
我们使用Cookie用于：
1. 保持登录状态
2. 记住用户偏好
3. 分析网站流量
用户可在浏览器设置中禁用Cookie。

六、用户权利
用户有权：
1. 查看个人信息
2. 修改个人信息
3. 删除个人信息
4. 导出个人数据
5. 注销账号

七、儿童隐私
本应用不面向18岁以下用户。
如发现未成年人使用，将立即删除其信息。

八、政策变更
本政策如有变更，将在应用内公布。

最后更新时间：2026-02-12
```

### 9.6 合规检查清单

**9.6.1 上线前合规检查**（优先级：P0）

**必须完成的检查项**：
- [ ] 风险提示在所有必要位置展示
- [ ] 免责声明完整且易于访问
- [ ] 用户协议和隐私政策已发布
- [ ] 不包含具体买卖时点建议
- [ ] 不包含收益承诺或保本承诺
- [ ] 不使用"稳赚"、"必涨"等绝对化用语
- [ ] 数据来源合法且已声明
- [ ] 资质声明清晰明确
- [ ] 所有操作建议附带风险提示
- [ ] AI分析结果标注"仅供参考"

**9.6.2 运营期合规监控**（优先级：P1）

**定期检查项**：
- 每月检查用户反馈，确保无误导性内容
- 每季度审查AI生成内容，确保合规
- 每半年更新免责声明和用户协议
- 每年进行合规培训

### 9.7 用户故事与验收标准

**用户故事1**：
> 作为用户，我希望清楚了解投资风险，以便理性投资。

**验收标准**：
- 首次使用时必须阅读风险提示
- 每份分析报告包含风险提示
- 风险等级清晰标注
- 风险因素具体列出

**用户故事2**：
> 作为合规人员，我希望产品符合监管要求，以便避免法律风险。

**验收标准**：
- 不提供具体买卖时点建议
- 不承诺收益或保本
- 所有建议附带"仅供参考"
- 免责声明完整且易于访问

---

## 10. 技术架构建议

### 10.1 整体架构

**10.1.1 架构图**（优先级：P0）

```
┌─────────────────────────────────────────────────────────┐
│                    用户层                                │
│  Web浏览器 / 桌面应用(Electron) / 移动应用(Phase 3)     │
└─────────────────┬───────────────────────────────────────┘
                  ↓ HTTPS
┌─────────────────────────────────────────────────────────┐
│                  CDN / 负载均衡                          │
│              Nginx / Cloudflare                          │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│                  应用层（API Gateway）                   │
│              FastAPI / Django REST                       │
├─────────────────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐│
│  │选股服务  │  │分析服务  │  │策略服务  │  │用户服务││
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘│
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│                  AI推理层                                │
│  ┌──────────────────┐  ┌──────────────────┐           │
│  │ LLM API          │  │ Agent编排        │           │
│  │ GPT-4/Claude/    │  │ 多Agent协作      │           │
│  │ DeepSeek/Qwen    │  │                  │           │
│  └──────────────────┘  └──────────────────┘           │
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│                  数据服务层                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐│
│  │数据获取  │  │数据清洗  │  │指标计算  │  │数据缓存││
│  │AKShare   │  │ETL       │  │技术指标  │  │Redis   ││
│  │Tushare   │  │          │  │财务指标  │  │        ││
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘│
└─────────────────┬───────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────────────────────┐
│                  数据存储层                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌─────────┐│
│  │PostgreSQL│  │InfluxDB  │  │Qdrant    │  │Redis   ││
│  │关系数据  │  │时序数据  │  │向量数据  │  │缓存    ││
│  └──────────┘  └──────────┘  └──────────┘  └─────────┘│
└─────────────────────────────────────────────────────────┘
```

**10.1.2 架构特点**

- **分层架构**：清晰的分层，便于维护和扩展
- **微服务化**：核心服务独立部署，便于水平扩展
- **异步处理**：长时间任务异步执行，提升用户体验
- **缓存优先**：多级缓存，减少数据库压力
- **高可用**：关键组件冗余部署，无单点故障

### 10.2 前端技术栈

**10.2.1 技术选型**（优先级：P0）

**方案A：React生态**（推荐）
```
框架：React 18+
状态管理：Zustand / Redux Toolkit
路由：React Router v6
UI组件库：Ant Design / Material-UI
图表库：ECharts / Recharts
构建工具：Vite
CSS方案：Tailwind CSS / CSS Modules
```

**优势**：
- 生态成熟，组件丰富
- 性能优秀，开发效率高
- 社区活跃，问题易解决
- Ant Design适合数据密集型应用

**方案B：Vue生态**
```
框架：Vue 3 + Composition API
状态管理：Pinia
路由：Vue Router v4
UI组件库：Element Plus / Naive UI
图表库：ECharts
构建工具：Vite
CSS方案：Tailwind CSS
```

**优势**：
- 学习曲线平缓
- 开发体验好
- 性能优秀

**MVP推荐**：方案A（React + Ant Design + ECharts）

**10.2.2 前端架构**（优先级：P0）

**目录结构**：
```
src/
├── components/          # 通用组件
│   ├── StockCard/      # 股票卡片
│   ├── Chart/          # 图表组件
│   └── Layout/         # 布局组件
├── pages/              # 页面组件
│   ├── StockPicker/    # 选股中心
│   ├── StockAnalysis/  # 个股分析
│   ├── MyStrategy/     # 我的策略
│   └── Market/         # 市场概览
├── services/           # API服务
│   ├── api.ts          # API封装
│   ├── stock.ts        # 股票相关API
│   └── strategy.ts     # 策略相关API
├── stores/             # 状态管理
│   ├── userStore.ts    # 用户状态
│   └── stockStore.ts   # 股票状态
├── utils/              # 工具函数
│   ├── format.ts       # 格式化
│   └── calculate.ts    # 计算函数
├── hooks/              # 自定义Hooks
│   ├── useStock.ts     # 股票数据Hook
│   └── useWebSocket.ts # WebSocket Hook
└── types/              # TypeScript类型定义
    ├── stock.ts
    └── strategy.ts
```

**10.2.3 状态管理策略**（优先级：P0）

**全局状态**（Zustand）：
- 用户信息：登录状态、用户配置
- 自选股列表：用户自选的股票
- 策略列表：用户保存的策略

**本地状态**（useState）：
- 表单输入：搜索框、筛选条件
- UI状态：弹窗显示、加载状态

**服务端状态**（React Query）：
- 股票数据：实时行情、K线数据
- 分析报告：个股分析结果
- 策略结果：选股结果列表

### 10.3 后端技术栈

**10.3.1 技术选型**（优先级：P0）

**方案A：Python + FastAPI**（推荐）
```
框架：FastAPI
异步：asyncio + uvicorn
ORM：SQLAlchemy 2.0
数据验证：Pydantic
任务队列：Celery + Redis
定时任务：APScheduler
数据分析：Pandas + NumPy
LLM集成：LangChain / OpenAI SDK
```

**优势**：
- Python生态丰富，数据分析库完善
- FastAPI性能优秀，开发效率高
- 异步支持好，适合I/O密集型任务
- 与AI/ML库集成方便

**方案B：Node.js + Express**
```
框架：Express / NestJS
ORM：Prisma / TypeORM
任务队列：Bull
定时任务：node-cron
LLM集成：LangChain.js
```

**优势**：
- 前后端统一语言
- 异步I/O性能好
- 生态成熟

**MVP推荐**：方案A（Python + FastAPI）

**10.3.2 后端架构**（优先级：P0）

**目录结构**：
```
backend/
├── app/
│   ├── api/                # API路由
│   │   ├── v1/
│   │   │   ├── stock.py    # 股票相关API
│   │   │   ├── strategy.py # 策略相关API
│   │   │   ├── analysis.py # 分析相关API
│   │   │   └── user.py     # 用户相关API
│   ├── core/               # 核心配置
│   │   ├── config.py       # 配置管理
│   │   ├── security.py     # 安全相关
│   │   └── database.py     # 数据库连接
│   ├── models/             # 数据模型
│   │   ├── stock.py        # 股票模型
│   │   ├── strategy.py     # 策略模型
│   │   └── user.py         # 用户模型
│   ├── schemas/            # Pydantic模型
│   │   ├── stock.py        # 股票Schema
│   │   └── strategy.py     # 策略Schema
│   ├── services/           # 业务逻辑
│   │   ├── data_service.py # 数据获取服务
│   │   ├── stock_service.py# 选股服务
│   │   ├── analysis_service.py # 分析服务
│   │   └── ai_service.py   # AI服务
│   ├── agents/             # AI Agent
│   │   ├── orchestrator.py # 主控Agent
│   │   ├── data_agent.py   # 数据获取Agent
│   │   └── analysis_agent.py # 分析Agent
│   ├── utils/              # 工具函数
│   │   ├── indicators.py   # 技术指标计算
│   │   ├── financial.py    # 财务指标计算
│   │   └── cache.py        # 缓存工具
│   └── tasks/              # 异步任务
│       ├── data_sync.py    # 数据同步任务
│       └── strategy_exec.py# 策略执行任务
├── tests/                  # 测试
│   ├── unit/               # 单元测试
│   └── integration/        # 集成测试
├── alembic/                # 数据库迁移
├── requirements.txt        # 依赖
└── main.py                 # 入口文件
```

**10.3.3 API设计规范**（优先级：P0）

**RESTful API设计**：
```
GET    /api/v1/stocks                    # 获取股票列表
GET    /api/v1/stocks/{code}             # 获取股票详情
GET    /api/v1/stocks/{code}/realtime    # 获取实时行情
GET    /api/v1/stocks/{code}/kline       # 获取K线数据
POST   /api/v1/stocks/{code}/analyze     # 分析股票

GET    /api/v1/strategies                # 获取策略列表
POST   /api/v1/strategies                # 创建策略
GET    /api/v1/strategies/{id}           # 获取策略详情
PUT    /api/v1/strategies/{id}           # 更新策略
DELETE /api/v1/strategies/{id}           # 删除策略
POST   /api/v1/strategies/{id}/execute   # 执行策略

POST   /api/v1/strategies/parse          # 解析自然语言策略
POST   /api/v1/strategies/custom/execute # 执行自定义策略

GET    /api/v1/market/overview            # 市场概览
GET    /api/v1/market/sectors             # 板块行情
```

**响应格式**：
```json
{
  "code": 200,
  "message": "success",
  "data": {
    // 实际数据
  },
  "timestamp": 1707753600
}
```

### 10.4 数据存储方案

**10.4.1 数据库选型**（优先级：P0）

**PostgreSQL**（关系型数据库）
- 用途：用户数据、策略数据、配置数据
- 版本：PostgreSQL 15+
- 特性：JSONB支持、全文搜索、事务支持

**表设计示例**：
```sql
-- 用户表
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 策略表
CREATE TABLE strategies (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    conditions JSONB NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 策略执行历史表
CREATE TABLE strategy_executions (
    id SERIAL PRIMARY KEY,
    strategy_id INTEGER REFERENCES strategies(id),
    executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    result_count INTEGER,
    result_snapshot JSONB
);
```

**InfluxDB**（时序数据库）
- 用途：K线数据、实时行情、技术指标
- 版本：InfluxDB 2.x
- 特性：高性能写入、自动压缩、时间范围查询

**数据结构示例**：
```
measurement: stock_kline
tags: stock_code, period (1d/1w/1m)
fields: open, high, low, close, volume, amount
time: timestamp
```

**Redis**（缓存数据库）
- 用途：热数据缓存、Session存储、任务队列
- 版本：Redis 7+
- 特性：高性能、多数据结构、持久化

**缓存策略**：
```
# 实时行情（TTL: 3秒）
stock:realtime:{code} → JSON

# 日K线（TTL: 1小时）
stock:kline:{code}:{period} → JSON

# 分析报告（TTL: 1小时）
stock:analysis:{code} → JSON

# 策略结果（TTL: 30分钟）
strategy:result:{strategy_id} → JSON
```

**Qdrant**（向量数据库）
- 用途：公告、新闻、研报的语义搜索
- 版本：Qdrant 1.x
- 特性：高性能向量检索、过滤支持

**10.4.2 数据分区策略**（优先级：P1）

**时间分区**（InfluxDB）：
- 日K线：按年分区
- 分钟K线：按月分区
- 实时行情：不分区（自动过期）

**范围分区**（PostgreSQL）：
- 策略执行历史：按月分区
- 用户操作日志：按月分区

### 10.5 任务调度与数据更新机制

**10.5.1 定时任务**（优先级：P0）

**APScheduler任务调度**：
```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler

scheduler = AsyncIOScheduler()

# 实时行情更新（交易时间每3秒）
@scheduler.scheduled_job('interval', seconds=3,
                         start_date='09:30', end_date='15:00')
async def update_realtime_quotes():
    # 更新全市场实时行情
    pass

# 日K线更新（每日16:00）
@scheduler.scheduled_job('cron', hour=16, minute=0)
async def update_daily_kline():
    # 更新所有股票日K线
    pass

# 财务数据更新（每日凌晨2:00）
@scheduler.scheduled_job('cron', hour=2, minute=0)
async def update_financial_data():
    # 更新财务数据
    pass

# 策略自动执行（每日9:00）
@scheduler.scheduled_job('cron', hour=9, minute=0)
async def auto_execute_strategies():
    # 自动执行用户保存的策略
    pass
```

**10.5.2 异步任务队列**（优先级：P1）

**Celery任务队列**：
```python
from celery import Celery

celery_app = Celery('stock_ai', broker='redis://localhost:6379/0')

# 长时间分析任务
@celery_app.task
def analyze_stock_async(stock_code: str):
    # 执行股票分析
    result = perform_analysis(stock_code)
    # 将结果存入Redis
    cache.set(f'analysis:{stock_code}', result, ex=3600)
    return result

# 批量选股任务
@celery_app.task
def execute_strategy_async(strategy_id: int):
    # 执行选股策略
    result = execute_strategy(strategy_id)
    return result
```

**任务优先级**：
- 高优先级：用户主动触发的分析任务
- 中优先级：定时数据更新任务
- 低优先级：批量数据处理任务

### 10.6 部署方案

**10.6.1 开发环境**（优先级：P0）

**Docker Compose部署**：
```yaml
version: '3.8'

services:
  frontend:
    build: ./frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
    environment:
      - VITE_API_URL=http://localhost:8000

  backend:
    build: ./backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
    environment:
      - DATABASE_URL=postgresql://user:pass@postgres:5432/stock_ai
      - REDIS_URL=redis://redis:6379/0
    depends_on:
      - postgres
      - redis
      - influxdb

  postgres:
    image: postgres:15
    ports:
      - "5432:5432"
    environment:
      - POSTGRES_DB=stock_ai
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data

  influxdb:
    image: influxdb:2.7
    ports:
      - "8086:8086"
    environment:
      - INFLUXDB_DB=stock_ai
    volumes:
      - influxdb_data:/var/lib/influxdb2

  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage

volumes:
  postgres_data:
  redis_data:
  influxdb_data:
  qdrant_data:
```

**10.6.2 生产环境**（优先级：P1）

**云服务器部署**（推荐阿里云/腾讯云）：

**服务器配置**（MVP阶段）：
- 应用服务器：2核4G × 2台（负载均衡）
- 数据库服务器：4核8G × 1台（PostgreSQL + Redis）
- 时序数据库：4核8G × 1台（InfluxDB）
- 总成本：约2000元/月

**部署架构**：
```
用户
  ↓
CDN（静态资源）
  ↓
负载均衡（Nginx）
  ↓
应用服务器1  应用服务器2
  ↓              ↓
数据库服务器（主从复制）
  ↓
时序数据库
```

**容器化部署**（Kubernetes，Phase 2）：
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: stock-ai-backend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: stock-ai-backend
  template:
    metadata:
      labels:
        app: stock-ai-backend
    spec:
      containers:
      - name: backend
        image: stock-ai-backend:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
```

**10.6.3 CI/CD流程**（优先级：P1）

**GitHub Actions**：
```yaml
name: CI/CD

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run tests
        run: |
          cd backend
          pip install -r requirements.txt
          pytest

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Build Docker image
        run: docker build -t stock-ai-backend:${{ github.sha }} .
      - name: Push to registry
        run: docker push stock-ai-backend:${{ github.sha }}

  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
      - name: Deploy to production
        run: |
          ssh user@server "docker pull stock-ai-backend:${{ github.sha }}"
          ssh user@server "docker-compose up -d"
```

### 10.7 监控与日志

**10.7.1 监控方案**（优先级：P1）

**Prometheus + Grafana**：
- 系统监控：CPU、内存、磁盘、网络
- 应用监控：QPS、响应时间、错误率
- 数据库监控：连接数、查询时间、慢查询
- 缓存监控：命中率、内存使用

**告警规则**：
```yaml
groups:
  - name: stock_ai_alerts
    rules:
      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 5m
        annotations:
          summary: "High error rate detected"

      - alert: HighResponseTime
        expr: http_request_duration_seconds{quantile="0.95"} > 10
        for: 5m
        annotations:
          summary: "High response time detected"
```

**10.7.2 日志方案**（优先级：P1）

**ELK Stack**（Elasticsearch + Logstash + Kibana）：
- 日志收集：Filebeat收集应用日志
- 日志处理：Logstash解析和转换
- 日志存储：Elasticsearch存储
- 日志查询：Kibana可视化查询

**日志格式**：
```json
{
  "timestamp": "2026-02-12T10:30:00Z",
  "level": "INFO",
  "service": "stock-ai-backend",
  "user_id": "12345",
  "request_id": "abc-123",
  "message": "Stock analysis completed",
  "duration_ms": 8500,
  "stock_code": "600519"
}
```

### 10.8 安全架构

**10.8.1 认证与授权**（优先级：P0）

**JWT认证**：
```python
from fastapi import Depends, HTTPException
from fastapi.security import HTTPBearer, HTTPAuthorizationCredentials
import jwt

security = HTTPBearer()

def verify_token(credentials: HTTPAuthorizationCredentials = Depends(security)):
    token = credentials.credentials
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=["HS256"])
        return payload
    except jwt.ExpiredSignatureError:
        raise HTTPException(status_code=401, detail="Token expired")
    except jwt.InvalidTokenError:
        raise HTTPException(status_code=401, detail="Invalid token")
```

**10.8.2 API安全**（优先级：P0）

**速率限制**：
```python
from slowapi import Limiter
from slowapi.util import get_remote_address

limiter = Limiter(key_func=get_remote_address)

@app.get("/api/v1/stocks")
@limiter.limit("100/minute")
async def get_stocks():
    # API逻辑
    pass
```

**CORS配置**：
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://yourdomain.com"],
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

### 10.9 用户故事与验收标准

**用户故事1**：
> 作为开发者，我希望技术栈成熟稳定，以便快速开发和维护。

**验收标准**：
- 前后端技术栈选型明确
- 架构清晰，模块划分合理
- 开发环境一键启动（Docker Compose）
- 代码结构规范，易于理解

**用户故事2**：
> 作为运维人员，我希望部署简单可靠，以便快速上线和扩展。

**验收标准**：
- 提供Docker镜像
- 支持一键部署
- 监控告警完善
- 日志集中管理

---

## 11. MVP范围与迭代路线图

### 11.1 MVP范围定义（Phase 1）

**11.1.1 MVP目标**（优先级：P0）

**核心目标**：
- 验证产品核心价值：AI驱动的选股与分析
- 验证技术可行性：自然语言策略解析、AI分析报告生成
- 获取早期用户反馈：了解用户真实需求
- 快速上线：3个月内完成开发并上线

**成功指标**：
- 注册用户：500人
- 日活用户：100人
- 策略执行次数：1000次/周
- 分析报告生成次数：500次/周
- 用户留存率（7日）：>30%
- 用户满意度：>4.0/5.0

**11.1.2 MVP功能清单**（优先级：P0）

**必须包含的功能**（P0）：

**1. 用户系统**
- [x] 用户注册/登录（邮箱+密码）
- [x] 用户信息管理
- [x] 自选股管理
- [ ] 第三方登录（微信/支付宝）- Phase 2

**2. 数据层**
- [x] 接入AKShare数据源
- [x] 实时行情数据（3秒更新）
- [x] 日K线数据
- [x] 基础财务数据（三大报表+关键指标）
- [x] 主力资金流向数据
- [ ] 分钟K线数据 - Phase 2
- [ ] Tushare Pro数据源 - Phase 2

**3. 选股中心**
- [x] 3个经典策略（格雷厄姆、巴菲特、彼得·林奇）
- [x] 策略参数调整
- [x] 选股结果展示（表格+排序）
- [x] 结果导出（CSV）
- [ ] 更多经典策略（5个以上）- Phase 2
- [ ] 策略回测 - Phase 3

**4. 自定义策略**
- [x] 自然语言输入
- [x] AI策略解析
- [x] 条件结构化展示
- [x] 策略执行
- [x] 策略保存
- [ ] 策略分享 - Phase 2
- [ ] 策略社区 - Phase 3

**5. 个股分析**
- [x] 股票搜索（代码/名称）
- [x] 基本面分析（财务健康度、盈利能力、成长性、估值）
- [x] 技术面分析（趋势、支撑压力、技术指标）
- [x] 资金面分析（主力资金、北向资金）
- [x] AI综合评估（评分、风险等级、操作建议）
- [ ] 消息面分析（公告、新闻）- Phase 2
- [ ] 同行业对比 - Phase 2

**6. 数据可视化**
- [x] K线图（日K）
- [x] 技术指标图（MACD、RSI）
- [x] 财务趋势图（ROE、营收、净利润）
- [ ] 资金流向图 - Phase 2
- [ ] 行业对比图 - Phase 2

**7. 市场概览**
- [x] 大盘指数（上证、深证、创业板）
- [x] 涨跌分布
- [ ] 板块行情 - Phase 2
- [ ] 资金流向 - Phase 2

**不包含的功能**（Phase 2/3）：
- [ ] 策略回测
- [ ] 组合管理
- [ ] 实时预警
- [ ] 移动端应用
- [ ] 社区功能
- [ ] 付费功能

**11.1.3 MVP技术栈**（优先级：P0）

**前端**：
- React 18 + TypeScript
- Ant Design（UI组件库）
- ECharts（图表库）
- Zustand（状态管理）
- React Query（数据获取）
- Vite（构建工具）

**后端**：
- Python 3.11 + FastAPI
- SQLAlchemy（ORM）
- PostgreSQL 15（关系数据库）
- Redis 7（缓存）
- InfluxDB 2.x（时序数据库）
- Celery（任务队列）

**AI/LLM**：
- GPT-4 Turbo（主力模型）
- DeepSeek-V3（备用模型）
- LangChain（Agent框架）

**部署**：
- Docker + Docker Compose
- 阿里云ECS（2核4G × 2台）
- Nginx（负载均衡）

**11.1.4 MVP开发计划**（优先级：P0）

**总周期：12周（3个月）**

**Week 1-2：项目启动与架构设计**
- 技术选型确认
- 架构设计评审
- 开发环境搭建
- 数据库设计
- API接口设计

**Week 3-4：数据层开发**
- AKShare数据接入
- 数据清洗与存储
- 实时行情更新任务
- 日K线更新任务
- 财务数据更新任务
- 缓存策略实现

**Week 5-6：选股功能开发**
- 3个经典策略实现
- 策略执行引擎
- 选股结果展示
- 前端选股页面
- 参数调整功能

**Week 7-8：自定义策略开发**
- 自然语言解析（LLM集成）
- 策略条件结构化
- 策略执行引擎
- 策略保存功能
- 前端自定义策略页面

**Week 9-10：个股分析开发**
- 基本面分析模块
- 技术面分析模块
- 资金面分析模块
- AI综合评估模块
- 前端分析报告页面
- K线图与技术指标图

**Week 11：集成测试与优化**
- 功能测试
- 性能测试
- 安全测试
- Bug修复
- 性能优化

**Week 12：上线准备**
- 生产环境部署
- 监控告警配置
- 用户文档编写
- 灰度发布
- 正式上线

### 11.2 Phase 2：功能增强（3-6个月）

**11.2.1 Phase 2目标**

**核心目标**：
- 完善核心功能：增加更多策略、完善分析维度
- 提升用户体验：优化性能、增强交互
- 扩展数据源：接入Tushare Pro、增加分钟K线
- 增加高级功能：策略回测、消息面分析

**成功指标**：
- 注册用户：5000人
- 日活用户：1000人
- 用户留存率（30日）：>40%
- 付费用户：100人（如有付费功能）

**11.2.2 Phase 2功能清单**

**1. 选股策略增强**
- [ ] 新增5个经典策略（技术分析、动量、多因子）
- [ ] 策略组合功能（多策略叠加）
- [ ] 策略效果追踪（T+5、T+10、T+20涨跌幅）
- [ ] 策略优化建议（AI推荐参数调整）

**2. 个股分析增强**
- [ ] 消息面分析（公告解析、新闻情感分析）
- [ ] 同行业对比（横向对比、行业排名）
- [ ] 历史分析记录（查看过去的分析报告）
- [ ] 分析报告导出（PDF格式）

**3. 数据源扩展**
- [ ] 接入Tushare Pro数据源
- [ ] 分钟K线数据（1/5/15/30/60分钟）
- [ ] 龙虎榜数据
- [ ] 机构评级数据
- [ ] 业绩预告数据

**4. 策略回测**
- [ ] 历史回测功能（模拟过去执行策略）
- [ ] 回测报告（收益曲线、最大回撤、夏普比率）
- [ ] 参数优化（自动寻找最优参数）
- [ ] 回测对比（多策略对比）

**5. 用户体验优化**
- [ ] 响应速度优化（<3秒）
- [ ] 移动端适配（响应式设计）
- [ ] 暗色主题
- [ ] 快捷键支持
- [ ] 个性化推荐（AI推荐股票）

**6. 数据可视化增强**
- [ ] 资金流向图（瀑布图、桑基图）
- [ ] 行业对比图（雷达图、散点图）
- [ ] 筹码分布图
- [ ] 财务对比图（多公司对比）

**11.2.3 Phase 2开发计划**

**总周期：12周（3个月）**

**Month 4：策略与分析增强**
- Week 1-2：新增5个经典策略
- Week 3-4：消息面分析、同行业对比

**Month 5：数据源扩展与回测**
- Week 1-2：接入Tushare Pro、分钟K线
- Week 3-4：策略回测功能开发

**Month 6：用户体验优化**
- Week 1-2：性能优化、移动端适配
- Week 3-4：数据可视化增强、测试上线

### 11.3 Phase 3：生态建设（6-12个月）

**11.3.1 Phase 3目标**

**核心目标**：
- 构建用户生态：策略社区、用户互动
- 移动端应用：iOS/Android应用
- 实时预警：价格预警、策略信号预警
- 组合管理：模拟持仓、收益追踪
- 商业化探索：付费功能、会员体系

**成功指标**：
- 注册用户：50000人
- 日活用户：10000人
- 付费用户：1000人
- 月收入：10万元

**11.3.2 Phase 3功能清单**

**1. 移动端应用**
- [ ] iOS应用（React Native/Flutter）
- [ ] Android应用
- [ ] 实时推送通知
- [ ] 移动端专属功能（快速查看、语音输入）

**2. 实时预警**
- [ ] 价格预警（涨跌幅、突破价位）
- [ ] 策略信号预警（策略筛选出新股票）
- [ ] 资金流向预警（主力大额流入/流出）
- [ ] 公告预警（重要公告推送）

**3. 组合管理**
- [ ] 模拟持仓（虚拟买卖）
- [ ] 收益追踪（持仓收益、历史收益）
- [ ] 组合分析（风险评估、资产配置）
- [ ] 交易记录（买卖记录、盈亏分析）

**4. 策略社区**
- [ ] 策略广场（用户分享策略）
- [ ] 策略评分（点赞、评论）
- [ ] 策略排行榜（收益率排行）
- [ ] 用户关注（关注其他用户）
- [ ] 策略订阅（订阅优质策略）

**5. 付费功能**
- [ ] 会员体系（免费版、专业版、旗舰版）
- [ ] 高级功能（更多策略、更快速度、更多数据）
- [ ] API接口（开放API给开发者）
- [ ] 定制服务（企业定制、私有部署）

**6. 市场扩展**
- [ ] 港股市场支持
- [ ] 美股市场支持
- [ ] 国际化（英文版）

**11.3.3 Phase 3开发计划**

**总周期：24周（6个月）**

**Month 7-8：移动端开发**
- 移动端应用开发
- 实时推送功能
- 移动端测试与上线

**Month 9-10：预警与组合**
- 实时预警功能
- 组合管理功能
- 交易记录与分析

**Month 11-12：社区与商业化**
- 策略社区开发
- 付费功能开发
- 会员体系上线
- 市场推广

### 11.4 功能优先级矩阵

**11.4.1 优先级评估模型**

**评估维度**：
- 用户价值（1-5分）：对用户的价值大小
- 技术难度（1-5分）：开发难度
- 开发成本（1-5分）：时间和资源成本
- 商业价值（1-5分）：对商业目标的贡献

**优先级计算**：
```
优先级得分 = (用户价值 × 0.4 + 商业价值 × 0.3) / (技术难度 × 0.2 + 开发成本 × 0.1)
```

**11.4.2 功能优先级排序**

| 功能 | 用户价值 | 技术难度 | 开发成本 | 商业价值 | 优先级得分 | Phase |
|------|---------|---------|---------|---------|-----------|-------|
| 经典选股策略 | 5 | 2 | 2 | 5 | 4.3 | MVP |
| 自然语言策略 | 5 | 4 | 4 | 5 | 2.5 | MVP |
| 个股AI分析 | 5 | 3 | 3 | 5 | 3.3 | MVP |
| 实时行情 | 5 | 2 | 2 | 4 | 4.0 | MVP |
| K线图 | 4 | 2 | 2 | 3 | 3.2 | MVP |
| 策略回测 | 4 | 3 | 3 | 4 | 2.7 | Phase 2 |
| 消息面分析 | 4 | 3 | 3 | 3 | 2.3 | Phase 2 |
| 同行业对比 | 3 | 2 | 2 | 3 | 2.7 | Phase 2 |
| 移动端应用 | 4 | 4 | 5 | 4 | 1.8 | Phase 3 |
| 实时预警 | 4 | 3 | 3 | 4 | 2.7 | Phase 3 |
| 组合管理 | 4 | 3 | 4 | 5 | 2.6 | Phase 3 |
| 策略社区 | 3 | 3 | 4 | 4 | 2.0 | Phase 3 |

### 11.5 风险与应对

**11.5.1 技术风险**

**风险1：AI分析准确性不足**
- 影响：用户不信任AI分析结果
- 概率：中
- 应对：
  - 持续优化Prompt工程
  - 收集用户反馈，迭代优化
  - 明确标注AI分析的局限性
  - 提供人工审核机制（Phase 2）

**风险2：数据源不稳定**
- 影响：数据更新延迟或中断
- 概率：中
- 应对：
  - 多数据源备份（AKShare + Tushare）
  - 数据质量监控与告警
  - 降级策略（使用缓存数据）

**风险3：性能瓶颈**
- 影响：响应时间过长，用户体验差
- 概率：中
- 应对：
  - 多级缓存策略
  - 异步任务处理
  - 数据库查询优化
  - 水平扩展（增加服务器）

**11.5.2 业务风险**

**风险1：用户增长不及预期**
- 影响：无法达到目标用户数
- 概率：高
- 应对：
  - 加强市场推广（社交媒体、社区）
  - 优化产品体验，提升留存率
  - 寻找种子用户，口碑传播
  - 与投资社区合作

**风险2：竞品压力**
- 影响：用户流失到竞品
- 概率：中
- 应对：
  - 强化差异化优势（自然语言策略、AI分析）
  - 快速迭代，保持产品领先
  - 建立用户粘性（策略保存、历史记录）

**风险3：合规风险**
- 影响：被监管部门处罚或下架
- 概率：低
- 应对：
  - 严格遵守证监会规定
  - 完善免责声明和风险提示
  - 定期合规审查
  - 咨询法律顾问

**11.5.3 运营风险**

**风险1：服务器成本过高**
- 影响：运营成本超出预算
- 概率：中
- 应对：
  - 优化资源使用，降低成本
  - 引入付费功能，增加收入
  - 寻求融资或投资

**风险2：团队人员不足**
- 影响：开发进度延迟
- 概率：中
- 应对：
  - 合理规划开发任务
  - 外包非核心功能
  - 招聘关键岗位人员

### 11.6 成功标准

**11.6.1 MVP成功标准**（3个月后）

**用户指标**：
- ✓ 注册用户：≥500人
- ✓ 日活用户：≥100人
- ✓ 用户留存率（7日）：≥30%
- ✓ 用户满意度：≥4.0/5.0

**功能指标**：
- ✓ 策略执行成功率：≥95%
- ✓ 分析报告生成成功率：≥95%
- ✓ 页面加载时间：<3秒
- ✓ 选股策略执行时间：<5秒
- ✓ 个股分析报告生成时间：<10秒

**技术指标**：
- ✓ 系统可用性：≥99.5%
- ✓ API响应时间（P95）：<2秒
- ✓ 数据更新延迟：<5分钟
- ✓ 错误率：<1%

**11.6.2 Phase 2成功标准**（6个月后）

**用户指标**：
- ✓ 注册用户：≥5000人
- ✓ 日活用户：≥1000人
- ✓ 用户留存率（30日）：≥40%
- ✓ 付费用户：≥100人（如有付费功能）

**功能指标**：
- ✓ 策略回测成功率：≥90%
- ✓ 消息面分析准确率：≥80%
- ✓ 移动端适配完成度：100%

**11.6.3 Phase 3成功标准**（12个月后）

**用户指标**：
- ✓ 注册用户：≥50000人
- ✓ 日活用户：≥10000人
- ✓ 付费用户：≥1000人
- ✓ 月收入：≥10万元

**生态指标**：
- ✓ 策略社区活跃度：≥1000个分享策略
- ✓ 移动端用户占比：≥30%
- ✓ 用户推荐率（NPS）：≥50

### 11.7 迭代原则

**11.7.1 核心原则**

1. **用户价值优先**：优先开发对用户价值最大的功能
2. **快速迭代**：小步快跑，快速验证假设
3. **数据驱动**：基于用户数据和反馈决策
4. **技术债务控制**：避免过度设计，但保持代码质量
5. **合规第一**：所有功能必须符合监管要求

**11.7.2 迭代流程**

```
需求收集
  ↓
优先级评估
  ↓
设计评审
  ↓
开发实现
  ↓
测试验证
  ↓
灰度发布
  ↓
数据监控
  ↓
用户反馈
  ↓
迭代优化
```

**11.7.3 版本发布节奏**

- **大版本**：每3个月发布一次（Phase 1 → Phase 2 → Phase 3）
- **小版本**：每2周发布一次（功能迭代、Bug修复）
- **热修复**：紧急Bug立即修复发布

### 11.8 总结

**产品愿景**：打造中国最好用的AI驱动股票分析工具

**核心竞争力**：
1. 自然语言策略引擎：无需编程，人人可用
2. AI深度分析：多维度智能分析，专业级报告
3. 经典策略内置：大师级投资策略，开箱即用
4. 真实数据驱动：接入权威数据源，数据可靠

**发展路径**：
- **Phase 1（MVP）**：验证核心价值，快速上线
- **Phase 2（增强）**：完善功能，提升体验
- **Phase 3（生态）**：构建生态，商业化探索

**关键里程碑**：
- 3个月：MVP上线，500用户
- 6个月：功能增强，5000用户
- 12个月：生态建设，50000用户，实现盈利

---

**文档版本**: v1.0
**创建日期**: 2026-02-12
**文档状态**: 已完成
**下一步行动**: 技术选型确认 → 架构设计评审 → 开发启动

---
